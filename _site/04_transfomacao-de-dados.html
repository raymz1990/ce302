<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>4 Transformação de dados</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./01_markdown_git.html" rel="" target="">
 <span class="menu-text">Documentação</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02_basicR.html" rel="" target="">
 <span class="menu-text">Ambiente R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./03_objects.html" rel="" target="">
 <span class="menu-text">Objetos em R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./04_transfomacao-de-dados.html" rel="" target="" aria-current="page">
 <span class="menu-text">Transformação de Dados</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./05_funcoes.html" rel="" target="">
 <span class="menu-text">Funções</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06_loopings.html" rel="" target="">
 <span class="menu-text">Loopings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./07_graphics.html" rel="" target="">
 <span class="menu-text">Gráficos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./08_comunicacao.html" rel="" target="">
 <span class="menu-text">Comunicação</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cheat-sheet" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Cheat Sheet</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cheat-sheet">
<li>
    <a class="dropdown-item" href="./10_markdown_cheatsheet.html" rel="" target="">
 <span class="dropdown-text">Markdown Cheat Sheet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11_git_cheatsheet.html" rel="" target="">
 <span class="dropdown-text">Git Cheat Sheet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12_git_rstudio_cheatsheet.html" rel="" target="">
 <span class="dropdown-text">Git RStudio Cheat Sheet</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-listas" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Listas</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-listas">
<li>
    <a class="dropdown-item" href="./listas/Lista1.html" rel="" target="">
 <span class="dropdown-text">Lista 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./listas/Lista2.html" rel="" target="">
 <span class="dropdown-text">Lista 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./listas/Lista3.html" rel="" target="">
 <span class="dropdown-text">Lista 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./listas/Lista4.html" rel="" target="">
 <span class="dropdown-text">Lista 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./listas/Lista5.html" rel="" target="">
 <span class="dropdown-text">Lista 05</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-scripts-aulas" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Scripts Aulas</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-scripts-aulas">
<li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_02.html" rel="" target="">
 <span class="dropdown-text">Aula 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_03.html" rel="" target="">
 <span class="dropdown-text">Aula 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_04.html" rel="" target="">
 <span class="dropdown-text">Aula 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_05.html" rel="" target="">
 <span class="dropdown-text">Aula 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_07.html" rel="" target="">
 <span class="dropdown-text">Aula 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_08.html" rel="" target="">
 <span class="dropdown-text">Aula 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_09.html" rel="" target="">
 <span class="dropdown-text">Aula 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_10.html" rel="" target="">
 <span class="dropdown-text">Aula 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./scripts_aulas/Aula_11.html" rel="" target="">
 <span class="dropdown-text">Aula 11</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modelos" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Modelos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-modelos">
<li>
    <a class="dropdown-item" href="./modelos_relatorios/01_exemplo_slide.html" rel="" target="">
 <span class="dropdown-text">Modelo Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./modelos_relatorios/02_exemplo_relatorio.html" rel="" target="">
 <span class="dropdown-text">Modelo Relatório</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./modelos_relatorios/03_exemplo_referencia.html" rel="" target="">
 <span class="dropdown-text">Modelo Referência Bibliográfica</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./modelos_relatorios/04_exemplo_shiny.html" rel="" target="">
 <span class="dropdown-text">Modelo Shiny</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./modelos_relatorios/05_exemplo_shiny_dash.html" rel="" target="">
 <span class="dropdown-text">Modelo Dashboard Shiny</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./modelos_relatorios/06_exemplo_scss.html" rel="" target="">
 <span class="dropdown-text">Modelo SCSS</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-provas" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Provas</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-provas">
<li>
    <a class="dropdown-item" href="./avaliacoes/avaliação_01.html" rel="" target="">
 <span class="dropdown-text">Prova 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./avaliacoes/avaliação_01.html" rel="" target="">
 <span class="dropdown-text">Prova 02</span></a>
  </li>  
    </ul>
</li>
</ul>
<div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#pipes" id="toc-pipes" class="nav-link active" data-scroll-target="#pipes">4.1 Pipes</a>
  <ul class="collapse">
<li><a href="#uso-do-pipe" id="toc-uso-do-pipe" class="nav-link" data-scroll-target="#uso-do-pipe">4.1.1 Uso do pipe</a></li>
  <li><a href="#benef%C3%ADcios-dos-pipes" id="toc-benefícios-dos-pipes" class="nav-link" data-scroll-target="#benef%C3%ADcios-dos-pipes">4.1.2 Benefícios dos Pipes</a></li>
  <li><a href="#pipe-de-atribui%C3%A7%C3%A3o" id="toc-pipe-de-atribuição" class="nav-link" data-scroll-target="#pipe-de-atribui%C3%A7%C3%A3o">4.1.3 Pipe de atribuição</a></li>
  </ul>
</li>
  <li>
<a href="#manipula%C3%A7%C3%A3o-de-dados" id="toc-manipulação-de-dados" class="nav-link" data-scroll-target="#manipula%C3%A7%C3%A3o-de-dados">4.2 Manipulação de Dados</a>
  <ul class="collapse">
<li><a href="#sele%C3%A7%C3%A3o-de-vari%C3%A1veis" id="toc-seleção-de-variáveis" class="nav-link" data-scroll-target="#sele%C3%A7%C3%A3o-de-vari%C3%A1veis">4.2.1 Seleção de Variáveis</a></li>
  <li><a href="#sele%C3%A7%C3%A3o-de-observa%C3%A7%C3%B5es" id="toc-seleção-de-observações" class="nav-link" data-scroll-target="#sele%C3%A7%C3%A3o-de-observa%C3%A7%C3%B5es">4.2.2 Seleção de Observações</a></li>
  <li><a href="#resumo-de-informa%C3%A7%C3%B5es" id="toc-resumo-de-informações" class="nav-link" data-scroll-target="#resumo-de-informa%C3%A7%C3%B5es">4.2.3 Resumo de informações</a></li>
  </ul>
</li>
  <li><a href="#exerc%C3%ADcio" id="toc-exercício" class="nav-link" data-scroll-target="#exerc%C3%ADcio">4.3 Exercício</a></li>
  <li>
<a href="#manipula%C3%A7%C3%A3o-de-data-no-r" id="toc-manipulação-de-data-no-r" class="nav-link" data-scroll-target="#manipula%C3%A7%C3%A3o-de-data-no-r">4.4 Manipulação de Data no R</a>
  <ul class="collapse">
<li><a href="#transformando-strings-em-datas" id="toc-transformando-strings-em-datas" class="nav-link" data-scroll-target="#transformando-strings-em-datas">4.4.1 Transformando Strings em Datas</a></li>
  <li><a href="#manipula%C3%A7%C3%A3o-de-datas" id="toc-manipulação-de-datas" class="nav-link" data-scroll-target="#manipula%C3%A7%C3%A3o-de-datas">4.4.2 Manipulação de Datas</a></li>
  <li><a href="#lubridate-facilitando-a-manipula%C3%A7%C3%A3o-de-datas-no-r" id="toc-lubridate-facilitando-a-manipulação-de-datas-no-r" class="nav-link" data-scroll-target="#lubridate-facilitando-a-manipula%C3%A7%C3%A3o-de-datas-no-r">4.4.3 Lubridate: Facilitando a Manipulação de Datas no R</a></li>
  </ul>
</li>
  <li><a href="#exerc%C3%ADcios" id="toc-exercícios" class="nav-link" data-scroll-target="#exerc%C3%ADcios">4.5 Exercícios</a></li>
  <li>
<a href="#jun%C3%A7%C3%A3o-de-dados" id="toc-junção-de-dados" class="nav-link" data-scroll-target="#jun%C3%A7%C3%A3o-de-dados">4.6 Junção de dados</a>
  <ul class="collapse">
<li><a href="#dados" id="toc-dados" class="nav-link" data-scroll-target="#dados">4.6.1 Dados</a></li>
  <li><a href="#chaves-prim%C3%A1rias-e-chaves-estrangeiras" id="toc-chaves-primárias-e-chaves-estrangeiras" class="nav-link" data-scroll-target="#chaves-prim%C3%A1rias-e-chaves-estrangeiras">4.6.2 Chaves Primárias e Chaves Estrangeiras</a></li>
  <li><a href="#combinando-dados" id="toc-combinando-dados" class="nav-link" data-scroll-target="#combinando-dados">4.6.3 Combinando dados</a></li>
  <li><a href="#jun%C3%A7%C3%B5es-mutacionais" id="toc-junções-mutacionais" class="nav-link" data-scroll-target="#jun%C3%A7%C3%B5es-mutacionais">4.6.4 Junções Mutacionais</a></li>
  <li><a href="#jun%C3%A7%C3%B5es-de-filtragem" id="toc-junções-de-filtragem" class="nav-link" data-scroll-target="#jun%C3%A7%C3%B5es-de-filtragem">4.6.5 Junções de Filtragem</a></li>
  </ul>
</li>
  <li><a href="#exerc%C3%ADcios-1" id="toc-exercícios-1" class="nav-link" data-scroll-target="#exerc%C3%ADcios-1">4.7 Exercícios</a></li>
  <li>
<a href="#organiza%C3%A7%C3%A3o-de-dados" id="toc-organização-de-dados" class="nav-link" data-scroll-target="#organiza%C3%A7%C3%A3o-de-dados">4.8 Organização de dados</a>
  <ul class="collapse">
<li><a href="#pivotagem" id="toc-pivotagem" class="nav-link" data-scroll-target="#pivotagem">4.8.1 Pivotagem</a></li>
  <li><a href="#exerc%C3%ADcio-1" id="toc-exercício-1" class="nav-link" data-scroll-target="#exerc%C3%ADcio-1">4.8.2 Exercício</a></li>
  <li><a href="#pivotando-dados-em-r" id="toc-pivotando-dados-em-r" class="nav-link" data-scroll-target="#pivotando-dados-em-r">4.8.2 Pivotando dados em R</a></li>
  <li><a href="#exemplo" id="toc-exemplo" class="nav-link" data-scroll-target="#exemplo">4.8.3 Exemplo</a></li>
  <li><a href="#exerc%C3%ADcios-2" id="toc-exercícios-2" class="nav-link" data-scroll-target="#exerc%C3%ADcios-2">4.8.4 Exercícios</a></li>
  </ul>
</li>
  <li>
<a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings">4.9 Strings</a>
  <ul class="collapse">
<li><a href="#caracteres-especiais" id="toc-caracteres-especiais" class="nav-link" data-scroll-target="#caracteres-especiais">4.9.1 Caracteres especiais</a></li>
  <li><a href="#concatenando-strings" id="toc-concatenando-strings" class="nav-link" data-scroll-target="#concatenando-strings">4.9.2 Concatenando strings</a></li>
  <li><a href="#separando-strings" id="toc-separando-strings" class="nav-link" data-scroll-target="#separando-strings">4.9.3 Separando Strings</a></li>
  <li><a href="#formata%C3%A7%C3%A3o-b%C3%A1sica" id="toc-formatação-básica" class="nav-link" data-scroll-target="#formata%C3%A7%C3%A3o-b%C3%A1sica">4.9.4 Formatação básica</a></li>
  <li><a href="#comprimento-de-string" id="toc-comprimento-de-string" class="nav-link" data-scroll-target="#comprimento-de-string">4.9.5 Comprimento de string</a></li>
  <li><a href="#substitui%C3%A7%C3%A3o-de-strings" id="toc-substituição-de-strings" class="nav-link" data-scroll-target="#substitui%C3%A7%C3%A3o-de-strings">4.9.6 Substituição de strings</a></li>
  <li><a href="#express%C3%B5es-regulares" id="toc-expressões-regulares" class="nav-link" data-scroll-target="#express%C3%B5es-regulares">4.9.7 Expressões Regulares</a></li>
  <li><a href="#exerc%C3%ADcio-2" id="toc-exercício-2" class="nav-link" data-scroll-target="#exerc%C3%ADcio-2">4.9.8 Exercício</a></li>
  </ul>
</li>
  <li><a href="#cheatsheets" id="toc-cheatsheets" class="nav-link" data-scroll-target="#cheatsheets">4.10 Cheatsheets</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RVerse-Tutorials/QmdReport/edit/main/04_transfomacao-de-dados.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/RVerse-Tutorials/QmdReport/blob/main/04_transfomacao-de-dados.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/RVerse-Tutorials/QmdReport/issues/new" class="toc-action">Report an issue</a></p></div></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="04_transfomacao-de-dados.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="04_transfomacao-de-dados.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">4 Transformação de dados</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="pipes" class="level2"><h2 class="anchored" data-anchor-id="pipes">4.1 Pipes</h2>
<p><img src="./imagens/pipes.png" class="img-fluid"></p>
<p>Uma maneira de fazermos os códigos em R mais legíveis é através da utilização dos operadores pipe. Os pipes fazem com a sequência das análises se torne mais aparente, o que torna o código muito menos complexo e mais fácil de ser alterado.</p>
<p>Tomemos como exemplo a seguinte análise: Seja <code>x</code> um vetor com 9 elementos, queremos obter um vetor ordenado do cosseno desses valores. Para fazer isso em R podemos aninhar diversas funções.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4 -3 -2 -1  0  1  2  3  4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.0000000  0.5403023  0.5403023 -0.4161468 -0.4161468 -0.6536436 -0.6536436
[8] -0.9899925 -0.9899925</code></pre>
</div>
</div>
<p>O que torna o código pouco legível e difícil de ser interpretado.</p>
<p>Podemos identar o código para faciliar a leitura:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span></span>
<span>      <span class="va">x</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>, </span>
<span>  decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.0000000  0.5403023  0.5403023 -0.4161468 -0.4161468 -0.6536436 -0.6536436
[8] -0.9899925 -0.9899925</code></pre>
</div>
</div>
<p>Contudo, ainda assim, o código não é de fácil compreensão, principalmente porque devemos ler o código de dentro para fora. Os pipes surgem como uma alternativa para solucionar esse problema, tornando os códigos mais legíveis e debugáveis. Os pipes, representados pelo operador <code>%&gt;%</code>, são uma característica poderosa e conveniente introduzida pelo pacote <code>magrittr</code> e amplamente adotada em R para simplificar a manipulação de dados. Os pipes permitem encadear sequências de operações em uma maneira legível e intuitiva, tornando o código mais conciso e fácil de entender.</p>
<p><strong>Funcionamento dos Pipes</strong>: O operador <code>%&gt;%</code> permite que você passe o resultado de uma expressão como o primeiro argumento de outra expressão. Isso é particularmente útil ao realizar uma série de transformações em um objeto sem a necessidade de criar variáveis intermediárias. O mesmo código que vimos anteriormente, com a utilização de pipe ficaria:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: magrittr</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span>decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.0000000  0.5403023  0.5403023 -0.4161468 -0.4161468 -0.6536436 -0.6536436
[8] -0.9899925 -0.9899925</code></pre>
</div>
</div>
<section id="uso-do-pipe" class="level3"><h3 class="anchored" data-anchor-id="uso-do-pipe">4.1.1 Uso do pipe</h3>
<ul>
<li>
<code>x %&gt;% f</code> é equivalente à <code>f(x)</code>
</li>
<li>
<code>x %&gt;% f(y)</code> é equivalente à <code>f(x, y)</code>
</li>
<li>
<code>x %&gt;% f %&gt;% g %&gt;% h</code> é equivalente à <code>h(g(f(x)))</code>
</li>
</ul>
<p>O <code>%&gt;%</code> significa que o elemento à esquerda sera avaliado pela função à direita.</p>
<p>Podemos também utilizar o <code>.</code> como espaço reservado para o elemento à esquerda, isto é:</p>
<ul>
<li>
<code>x %&gt;% f(y, .)</code> é equivalente à <code>f(y, x)</code>
</li>
<li>
<code>x %&gt;% f(., y)</code> é equivalente à <code>f(x, y)</code>
</li>
<li>
<code>x %&gt;% f(y, z = .)</code> é equivalente à <code>f(y, z = x)</code>.</li>
</ul>
<section id="exemplos" class="level4"><h4 class="anchored" data-anchor-id="exemplos">4.1.1.1 Exemplos</h4>
<p>Note que não conseguimos utilizar o <code>%&gt;%</code> com operadores aritiméticos. Portanto, uma alternativa é utiliarmos as funções <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">add()</a></code>, <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">subtract()</a></code>, <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">multiply_by()</a></code>, <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">raise_to_power()</a></code>, <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">divide_by()</a></code> etc. Para a lista completa de funções, utilize <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">?add</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>    <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">multiply_by</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">add</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2.197622  3.849113 12.793542  5.352542  5.646439 13.575325  7.304581
 [8] -1.325306  1.565736  2.771690</code></pre>
</div>
</div>
<p>Outra opção é utilizarmos os a operação entre aspas.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">`*`</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">`+`</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2.197622  3.849113 12.793542  5.352542  5.646439 13.575325  7.304581
 [8] -1.325306  1.565736  2.771690</code></pre>
</div>
</div>
</section></section><section id="benefícios-dos-pipes" class="level3"><h3 class="anchored" data-anchor-id="benefícios-dos-pipes">4.1.2 Benefícios dos Pipes</h3>
<ul>
<li><p><strong>Legibilidade</strong>: Os pipes permitem ler o código da esquerda para a direita, refletindo a sequência de operações realizadas.</p></li>
<li><p><strong>Redução de Variáveis Intermediárias</strong>: Com pipes, não precisamos criar variáveis intermediárias para armazenar resultados parciais.</p></li>
<li><p><strong>Encadeamento Simples</strong>: O encadeamento de operações se torna mais intuitivo e fácil de seguir o código e procedimentos.</p></li>
<li><p><strong>Depuração</strong>: Ao usar pipes, podemos isolar cada etapa para depuração, facilitando a identificação de erros.</p></li>
</ul></section><section id="pipe-de-atribuição" class="level3"><h3 class="anchored" data-anchor-id="pipe-de-atribuição">4.1.3 Pipe de atribuição</h3>
<p>Muitas vezes queremos realizar opereções e atribuir os resultados ao mesmo <code>data.frame</code> de entrada, por exemplo, podemos querer criar uma nova variável em <code>meu_data_frame</code>, porem, não temos interesse em duplicar o banco de dados. Podemos fazer uma atribuição explicita ou implicita. Para a explicita, simplismente atribuímos utilizando <code>=</code> ou <code>&lt;-</code>, como vimos até agora durante o curso. Porém, podemos fazer uma atribuição implicita utilizando o operador <code>%&lt;&gt;%</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Atribuição explicita</span></span>
<span><span class="va">meu_data_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  nome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Carol"</span>, <span class="st">"Ana"</span>, <span class="st">"João"</span>, <span class="st">"Carlos"</span>, <span class="st">"Patrícia"</span>, <span class="st">"Leonardo"</span><span class="op">)</span>,</span>
<span>  idade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">28</span>, <span class="fl">20</span>, <span class="fl">27</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">45</span><span class="op">)</span>,</span>
<span>  salario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">6000</span>, <span class="fl">5500</span>, <span class="fl">8000</span>, <span class="fl">2000</span>, <span class="fl">3500</span>, <span class="fl">10000</span>, <span class="fl">3800</span> <span class="op">)</span>, </span>
<span>  meio_de_transporte <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'onibus'</span>, <span class="st">'bicicleta'</span>, <span class="st">'onibus'</span>, <span class="st">'carro'</span>, <span class="st">'carro'</span>, <span class="st">'onibus'</span>, <span class="st">'onibus'</span>, <span class="st">'bicicleta'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meu_data_frame</span> <span class="op">=</span> <span class="va">meu_data_frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>idade_25 <span class="op">=</span> <span class="va">idade</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">meu_data_frame</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8
Columns: 5
$ nome               &lt;chr&gt; "Alice", "Bob", "Carol", "Ana", "João", "Carlos", "…
$ idade              &lt;dbl&gt; 25, 30, 28, 20, 27, 50, 60, 45
$ salario            &lt;dbl&gt; 5000, 6000, 5500, 8000, 2000, 3500, 10000, 3800
$ meio_de_transporte &lt;chr&gt; "onibus", "bicicleta", "onibus", "carro", "carro", …
$ idade_25           &lt;lgl&gt; FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Atribuição implicita</span></span>
<span><span class="va">meu_data_frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>idade_50 <span class="op">=</span> <span class="va">idade</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">meu_data_frame</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8
Columns: 6
$ nome               &lt;chr&gt; "Alice", "Bob", "Carol", "Ana", "João", "Carlos", "…
$ idade              &lt;dbl&gt; 25, 30, 28, 20, 27, 50, 60, 45
$ salario            &lt;dbl&gt; 5000, 6000, 5500, 8000, 2000, 3500, 10000, 3800
$ meio_de_transporte &lt;chr&gt; "onibus", "bicicleta", "onibus", "carro", "carro", …
$ idade_25           &lt;lgl&gt; FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE
$ idade_50           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FAL…</code></pre>
</div>
</div>
</section></section><section id="manipulação-de-dados" class="level2"><h2 class="anchored" data-anchor-id="manipulação-de-dados">4.2 Manipulação de Dados</h2>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: data.table</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: tidyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:magrittr':

    extract</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./datasets/Brazil Total highway crashes 2010 - 2023.csv.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dados extraídos de https://www.kaggle.com/datasets/liamarguedas/brazil-total-highway-crashes-2010-2023</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864,561
Columns: 24
$ data                           &lt;chr&gt; "01/01/2010", "01/01/2010", "01/01/2010…
$ horario                        &lt;chr&gt; "04:21:00", "02:13:00", "03:35:00", "07…
$ n_da_ocorrencia                &lt;chr&gt; "18", "20", "000024/2010", "000038/2010…
$ tipo_de_ocorrencia             &lt;chr&gt; "sem vítima", "sem vítima", "sem vítima…
$ km                             &lt;chr&gt; "167", "269,5", "77", "52", "33", "24",…
$ trecho                         &lt;chr&gt; "BR-393/RJ", "BR-116/PR", "BR-290/RS", …
$ sentido                        &lt;chr&gt; "Norte", "Sul", "Norte", "Norte", "Nort…
$ lugar_acidente                 &lt;chr&gt; "Rodovia do Aço", "Autopista Regis Bitt…
$ tipo_de_acidente               &lt;chr&gt; "Derrapagem", "Colisão Traseira", "COLI…
$ automovel                      &lt;int&gt; 1, 2, 2, 0, 0, 1, 1, 1, 2, 1, NA, 1, 1,…
$ bicicleta                      &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ caminhao                       &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ moto                           &lt;int&gt; NA, NA, 0, 1, 1, 0, NA, NA, NA, NA, 1, …
$ onibus                         &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ outros                         &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ tracao_animal                  &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ transporte_de_cargas_especiais &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ trator_maquinas                &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ utilitarios                    &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ ilesos                         &lt;int&gt; 1, 3, 2, 1, 1, 1, 3, 4, 4, 1, 0, 1, 1, …
$ levemente_feridos              &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, 5, NA, 2, NA…
$ moderadamente_feridos          &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …
$ gravemente_feridos             &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …
$ mortos                         &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<section id="seleção-de-variáveis" class="level3"><h3 class="anchored" data-anchor-id="seleção-de-variáveis">4.2.1 Seleção de Variáveis</h3>
<p>No <code>tidyverse</code>, a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> do pacote <code>dplyr</code> é amplamente utilizada para selecionar as colunas relevantes de um conjunto de dados. Além de selecionar colunas pelo nome, a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> oferece diversas opções avançadas para facilitar a seleção e manipulação de colunas. Vamos explorar algumas dessas opções:</p>
<section id="seleção-por-nome-de-coluna" class="level4"><h4 class="anchored" data-anchor-id="seleção-por-nome-de-coluna">4.2.1.1 Seleção por Nome de Coluna</h4>
<p>A forma mais simples de usar o <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> é especificar os nomes das colunas que você deseja manter no resultado, por exemplo, podemos estar interessados em selecionarmos a <code>data</code> e o <code>tipo_de_acidente</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">tipo_de_acidente</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         data tipo_de_acidente
1: 01/01/2010       Derrapagem
2: 01/01/2010 Colisão Traseira
3: 01/01/2010  COLISÃO LATERAL
4: 01/01/2010    QUEDA DE MOTO
5: 01/01/2010    QUEDA DE MOTO
6: 01/01/2010   SAÍDA DE PISTA</code></pre>
</div>
</div>
<ol type="1">
<li>Seleção por Nome de Coluna que inicie com alguma palavra - <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>: Essa função permite selecionar colunas cujos nomes começam com um determinado padrão de caracteres. No nosso banco de dados, podemos estar interessados em selecionar todas as variáveis que iniciem com “tipo”.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"tipo"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tipo_de_ocorrencia tipo_de_acidente
1:         sem vítima       Derrapagem
2:         sem vítima Colisão Traseira
3:         sem vítima  COLISÃO LATERAL
4:         sem vítima    QUEDA DE MOTO
5:         sem vítima    QUEDA DE MOTO
6:         sem vítima   SAÍDA DE PISTA</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Seleção por Nome de Coluna que termine com alguma palavra - <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>: Essa função permite selecionar colunas cujos nomes terminam com um determinado padrão de caracteres. No nosso banco de dados, podemos estar interessados em selecionar todas as variáveis que terminem com “feridos”.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"feridos"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   levemente_feridos moderadamente_feridos gravemente_feridos
1:                 0                     0                  0
2:                NA                    NA                 NA
3:                 0                     0                  0
4:                 0                     0                  0
5:                 0                     0                  0
6:                 0                     0                  0</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Seleção por Nome de Coluna que contenha alguma palavra - <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code>: Essa função permite selecionar colunas cujos nomes contenham um determinado padrão de caracteres. No nosso banco de dados, podemos estar interessados em selecionar todas as variáveis que contenham “mente”.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"mente"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   levemente_feridos moderadamente_feridos gravemente_feridos
1:                 0                     0                  0
2:                NA                    NA                 NA
3:                 0                     0                  0
4:                 0                     0                  0
5:                 0                     0                  0
6:                 0                     0                  0</code></pre>
</div>
</div>
</section><section id="seleção-de-variáveis-por-tipos-específicos-de-dados" class="level4"><h4 class="anchored" data-anchor-id="seleção-de-variáveis-por-tipos-específicos-de-dados">4.2.1.2 Seleção de variáveis por Tipos específicos de dados</h4>
<p>Muitas vezes, estamos interessados em selecionar apenas variáveis de um tipo, para tratarmos os dados da maneira mais adequada.</p>
<ol type="1">
<li>Selecionar apenas variáveis numéricas: <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code>
</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864,561
Columns: 15
$ automovel                      &lt;int&gt; 1, 2, 2, 0, 0, 1, 1, 1, 2, 1, NA, 1, 1,…
$ bicicleta                      &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ caminhao                       &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ moto                           &lt;int&gt; NA, NA, 0, 1, 1, 0, NA, NA, NA, NA, 1, …
$ onibus                         &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ outros                         &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ tracao_animal                  &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ transporte_de_cargas_especiais &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ trator_maquinas                &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ utilitarios                    &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA,…
$ ilesos                         &lt;int&gt; 1, 3, 2, 1, 1, 1, 3, 4, 4, 1, 0, 1, 1, …
$ levemente_feridos              &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, 5, NA, 2, NA…
$ moderadamente_feridos          &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …
$ gravemente_feridos             &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …
$ mortos                         &lt;int&gt; 0, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Selecionar apenas variáveis characters: <code><a href="https://rdrr.io/r/base/character.html">is.character()</a></code>
</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864,561
Columns: 9
$ data               &lt;chr&gt; "01/01/2010", "01/01/2010", "01/01/2010", "01/01/20…
$ horario            &lt;chr&gt; "04:21:00", "02:13:00", "03:35:00", "07:31:00", "04…
$ n_da_ocorrencia    &lt;chr&gt; "18", "20", "000024/2010", "000038/2010", "000027/2…
$ tipo_de_ocorrencia &lt;chr&gt; "sem vítima", "sem vítima", "sem vítima", "sem víti…
$ km                 &lt;chr&gt; "167", "269,5", "77", "52", "33", "24", "52", "40",…
$ trecho             &lt;chr&gt; "BR-393/RJ", "BR-116/PR", "BR-290/RS", "BR-116/RS",…
$ sentido            &lt;chr&gt; "Norte", "Sul", "Norte", "Norte", "Norte", "Sul", "…
$ lugar_acidente     &lt;chr&gt; "Rodovia do Aço", "Autopista Regis Bittencourt", "C…
$ tipo_de_acidente   &lt;chr&gt; "Derrapagem", "Colisão Traseira", "COLISÃO LATERAL"…</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Selecionar apenas variáveis lógicas: <code><a href="https://rdrr.io/r/base/logical.html">is.logical()</a></code>
</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.logical</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 0
Columns: 0</code></pre>
</div>
</div>
</section><section id="seleção-por-critérios" class="level4"><h4 class="anchored" data-anchor-id="seleção-por-critérios">4.2.1.3 Seleção por critérios</h4>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code>: Permitem usar variáveis definidas externamente como argumentos da função. Note que quando utilizamos <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of()</a></code> todas as variáveis devem existir, já <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code> permite que nem todas as variáveis existam no banco de dados.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vars_interesse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"automovel"</span>, <span class="st">"bicicleta"</span>, <span class="st">"onibus"</span><span class="op">)</span></span>
<span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vars_interesse</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864,561
Columns: 3
$ automovel &lt;int&gt; 1, 2, 2, 0, 0, 1, 1, 1, 2, 1, NA, 1, 1, 2, 2, 1, 1, NA, 1, 2…
$ bicicleta &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, N…
$ onibus    &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, N…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vars_interesse2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"automovel"</span>, <span class="st">"bicicleta"</span>, <span class="st">"onibus"</span>, <span class="st">"trator"</span><span class="op">)</span></span>
<span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="va">vars_interesse2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864,561
Columns: 3
$ automovel &lt;int&gt; 1, 2, 2, 0, 0, 1, 1, 1, 2, 1, NA, 1, 1, 2, 2, 1, 1, NA, 1, 2…
$ bicicleta &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, N…
$ onibus    &lt;int&gt; NA, NA, 0, 0, 0, 0, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, N…</code></pre>
</div>
</div>
</section></section><section id="seleção-de-observações" class="level3"><h3 class="anchored" data-anchor-id="seleção-de-observações">4.2.2 Seleção de Observações</h3>
<p>No pacote <code>dplyr</code> do tidyverse, a função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> é amplamente utilizada para filtrar linhas de um conjunto de dados com base em condições específicas. Ela oferece diversas opções para criar filtros complexos que atendam às suas necessidades de análise. Vamos explorar diferentes tipos de filtros e como utilizá-los de maneira eficaz.</p>
<section id="filtros-simples" class="level4"><h4 class="anchored" data-anchor-id="filtros-simples">4.2.2.1 Filtros Simples</h4>
<p>Filtros simples envolvem comparações entre valores de uma coluna e um valor constante. Alguns operadores de comparação comuns incluem:</p>
<ul>
<li><p><code>==</code>: Igual a</p></li>
<li><p><code>!=</code>: Diferente de</p></li>
<li><p><code>&lt;</code>: Menor que</p></li>
<li><p><code>&gt;</code>: Maior que</p></li>
<li><p><code>&lt;=</code>: Menor ou igual a</p></li>
<li><p><code>&gt;=</code>: Maior ou igual a</p></li>
</ul>
<p>Podemos estar interessados em filtrar as observações com pelo menos três carros envolvidos no acidente:</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">automovel</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             data  horario n_da_ocorrencia         tipo_de_ocorrencia      km
    1: 01/01/2010 13:14:00             150                 sem vítima     560
    2: 01/01/2011 23:21:00             542                 sem vítima   137,5
    3: 01/01/2011 12:21:00             212                 sem vítima    68,8
    4: 01/01/2011 13:55:00             135                 sem vítima     269
    5: 01/01/2011 14:57:00             309                 sem vítima     193
   ---                                                                       
34384: 31/12/2021 07:00:03             115                 Sem vítima 626,434
34385: 31/12/2021 21:43:00             388                 Sem vítima 131,806
34386: 31/12/2021 17:36:28             247                 Sem vítima 269,670
34387: 31/12/2022 19:53:19             571 ac02 - Acidente com Vítima 445,000
34388: 31/12/2022 10:18:00             206        Acidente com vítima      44
          trecho     sentido              lugar_acidente
    1: BR-116/PR         Sul Autopista Regis Bittencourt
    2: BR-101/SC       Norte       Autopista Litoral Sul
    3: BR-116/SP   Pista Sul                   Novadutra
    4: BR-116/PR       Norte Autopista Regis Bittencourt
    5: BR-101/SC       Norte       Autopista Litoral Sul
   ---                                                  
34384: BR-376/SC Decrescente       Autopista Litoral Sul
34385: BR-101/SC Decrescente       Autopista Litoral Sul
34386: BR-116/SP   Crescente Autopista Regis Bittencourt
34387: BR-262/MG       Oeste                    Concebra
34388: BR-101/SP Pista Norte                       RIOSP
                    tipo_de_acidente automovel bicicleta caminhao moto onibus
    1:              Colisão Traseira         3        NA       NA   NA     NA
    2:              Colisão Traseira         3        NA       NA   NA     NA
    3: Choque em barreira New Jersey         3         0        0    0      0
    4:                 Engavetamento         4        NA       NA   NA     NA
    5:              Colisão Traseira         3        NA       NA   NA     NA
   ---                                                                       
34384:                 Engavetamento         3         0        0    0      0
34385:                 Engavetamento         3         0        0    0      0
34386:                 Engavetamento         3         0        0    0      0
34387:               Colisão Lateral         3         0        0    0      0
34388:                 Engavetamento         3         0        0    0      0
       outros tracao_animal transporte_de_cargas_especiais trator_maquinas
    1:     NA            NA                             NA              NA
    2:     NA            NA                             NA              NA
    3:      0             0                             NA               0
    4:     NA            NA                             NA              NA
    5:     NA            NA                             NA              NA
   ---                                                                    
34384:      0             0                              0               0
34385:      0             0                              0               0
34386:      0             0                              0               0
34387:      0             0                              0               0
34388:      0             0                             NA               0
       utilitarios ilesos levemente_feridos moderadamente_feridos
    1:          NA     14                NA                    NA
    2:          NA      3                NA                    NA
    3:           0     11                 0                     0
    4:          NA      7                NA                    NA
    5:          NA      3                NA                    NA
   ---                                                           
34384:           0      3                 0                     0
34385:           0      3                 0                     0
34386:           1      4                 0                     0
34387:           0      2                 0                     0
34388:           0     10                 1                     0
       gravemente_feridos mortos
    1:                 NA     NA
    2:                 NA     NA
    3:                  0      0
    4:                 NA     NA
    5:                 NA     NA
   ---                          
34384:                  0      0
34385:                  0      0
34386:                  0      0
34387:                  0      0
34388:                  0      0</code></pre>
</div>
</div>
</section><section id="filtros-combinados" class="level4"><h4 class="anchored" data-anchor-id="filtros-combinados">4.2.2.2 Filtros Combinados</h4>
<p>Você pode combinar filtros usando os operadores lógicos <code>&amp;</code> (AND) e <code>|</code> (OR) para criar condições mais complexas.</p>
<p>Podemos estar interessados em filtrar as observações com pelo menos três carros e dois caminhões envolvidos no acidente:</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">automovel</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">caminhao</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           data  horario n_da_ocorrencia tipo_de_ocorrencia                 km
  1: 01/02/2018 07:45:00             119         sem vítima             41,941
  2: 01/03/2012 09:04:00             163         com vítima 111,19999694824219
  3: 01/03/2019 00:07:00               2         sem vítima              667,5
  4: 01/04/2011 08:32:00             223         sem vítima              222,7
  5: 01/06/2014 16:47:00             238         com vítima            676,662
 ---                                                                          
173: 29/11/2017 16:38:00             592         com vítima  96,30000305175781
174: 30/10/2012 13:15:00             437         com vítima              133,2
175: 31/03/2013 19:30:00             468         com vítima              540,5
176: 31/03/2014 15:56:00             228         sem vítima                656
177: 31/10/2011 06:28:00             121         com vítima                208
        trecho     sentido        lugar_acidente tipo_de_acidente automovel
  1: BR-101/SC       Norte Autopista Litoral Sul    Engavetamento         3
  2: BR-116/PR         Sul Autopista Litoral Sul Colisão Traseira         3
  3: BR-376/PR         Sul Autopista Litoral Sul    Engavetamento         8
  4: BR-116/RJ Pista Norte             Novadutra    Engavetamento         3
  5: BR-376/PR         Sul Autopista Litoral Sul    Engavetamento         4
 ---                                                                       
173: BR-116/SP Pista Norte             Novadutra    Engavetamento         7
174: BR-116/SP Pista Norte             Novadutra    Engavetamento         3
175: BR-381/MG       Norte Autopista Fernão Dias    Engavetamento         5
176: BR-376/PR       Norte Autopista Litoral Sul    Engavetamento         3
177: BR-116/RJ Pista Norte             Novadutra    Engavetamento         3
     bicicleta caminhao moto onibus outros tracao_animal
  1:        NA        3   NA     NA     NA            NA
  2:        NA        3    1     NA     NA            NA
  3:        NA        4   NA     NA     NA            NA
  4:         0        3    0      0      0             0
  5:        NA        4   NA     NA     NA            NA
 ---                                                    
173:        NA        3   NA     NA     NA            NA
174:         0        3    0      0      0             0
175:        NA        3   NA     NA     NA            NA
176:        NA        4   NA     NA     NA            NA
177:         0        3    0      0      1             0
     transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
  1:                             NA              NA           1      7
  2:                             NA              NA          NA      6
  3:                             NA              NA          NA     29
  4:                             NA               0           0      8
  5:                             NA              NA          NA      3
 ---                                                                  
173:                             NA              NA          NA     19
174:                             NA               0           0      8
175:                             NA              NA          NA      7
176:                             NA              NA           2      9
177:                             NA               0           0      6
     levemente_feridos moderadamente_feridos gravemente_feridos mortos
  1:                NA                    NA                 NA     NA
  2:                 1                    NA                 NA     NA
  3:                NA                    NA                 NA     NA
  4:                 0                     0                  0      0
  5:                NA                     2                  3      5
 ---                                                                  
173:                 1                    NA                 NA     NA
174:                 1                     0                  0      0
175:                 1                    NA                 NA     NA
176:                NA                    NA                 NA     NA
177:                 1                     0                  0      0</code></pre>
</div>
</div>
<p>Podemos omitir o operador lógico <code>&amp;</code>, então a função ficaria:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">automovel</span> <span class="op">&gt;=</span> <span class="fl">3</span>, <span class="va">caminhao</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           data  horario n_da_ocorrencia tipo_de_ocorrencia                 km
  1: 01/02/2018 07:45:00             119         sem vítima             41,941
  2: 01/03/2012 09:04:00             163         com vítima 111,19999694824219
  3: 01/03/2019 00:07:00               2         sem vítima              667,5
  4: 01/04/2011 08:32:00             223         sem vítima              222,7
  5: 01/06/2014 16:47:00             238         com vítima            676,662
 ---                                                                          
173: 29/11/2017 16:38:00             592         com vítima  96,30000305175781
174: 30/10/2012 13:15:00             437         com vítima              133,2
175: 31/03/2013 19:30:00             468         com vítima              540,5
176: 31/03/2014 15:56:00             228         sem vítima                656
177: 31/10/2011 06:28:00             121         com vítima                208
        trecho     sentido        lugar_acidente tipo_de_acidente automovel
  1: BR-101/SC       Norte Autopista Litoral Sul    Engavetamento         3
  2: BR-116/PR         Sul Autopista Litoral Sul Colisão Traseira         3
  3: BR-376/PR         Sul Autopista Litoral Sul    Engavetamento         8
  4: BR-116/RJ Pista Norte             Novadutra    Engavetamento         3
  5: BR-376/PR         Sul Autopista Litoral Sul    Engavetamento         4
 ---                                                                       
173: BR-116/SP Pista Norte             Novadutra    Engavetamento         7
174: BR-116/SP Pista Norte             Novadutra    Engavetamento         3
175: BR-381/MG       Norte Autopista Fernão Dias    Engavetamento         5
176: BR-376/PR       Norte Autopista Litoral Sul    Engavetamento         3
177: BR-116/RJ Pista Norte             Novadutra    Engavetamento         3
     bicicleta caminhao moto onibus outros tracao_animal
  1:        NA        3   NA     NA     NA            NA
  2:        NA        3    1     NA     NA            NA
  3:        NA        4   NA     NA     NA            NA
  4:         0        3    0      0      0             0
  5:        NA        4   NA     NA     NA            NA
 ---                                                    
173:        NA        3   NA     NA     NA            NA
174:         0        3    0      0      0             0
175:        NA        3   NA     NA     NA            NA
176:        NA        4   NA     NA     NA            NA
177:         0        3    0      0      1             0
     transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
  1:                             NA              NA           1      7
  2:                             NA              NA          NA      6
  3:                             NA              NA          NA     29
  4:                             NA               0           0      8
  5:                             NA              NA          NA      3
 ---                                                                  
173:                             NA              NA          NA     19
174:                             NA               0           0      8
175:                             NA              NA          NA      7
176:                             NA              NA           2      9
177:                             NA               0           0      6
     levemente_feridos moderadamente_feridos gravemente_feridos mortos
  1:                NA                    NA                 NA     NA
  2:                 1                    NA                 NA     NA
  3:                NA                    NA                 NA     NA
  4:                 0                     0                  0      0
  5:                NA                     2                  3      5
 ---                                                                  
173:                 1                    NA                 NA     NA
174:                 1                     0                  0      0
175:                 1                    NA                 NA     NA
176:                NA                    NA                 NA     NA
177:                 1                     0                  0      0</code></pre>
</div>
</div>
<p>Podemos estar interessados em filtrar as observações com pelo menos três carros OU dois caminhões envolvidos no acidente:</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">automovel</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">caminhao</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             data  horario n_da_ocorrencia         tipo_de_ocorrencia      km
    1: 01/01/2010 13:14:00             150                 sem vítima     560
    2: 01/01/2011 23:21:00             542                 sem vítima   137,5
    3: 01/01/2011 12:21:00             212                 sem vítima    68,8
    4: 01/01/2011 13:55:00             135                 sem vítima     269
    5: 01/01/2011 14:57:00             309                 sem vítima     193
   ---                                                                       
39204: 31/12/2021 21:43:00             388                 Sem vítima 131,806
39205: 31/12/2021 17:36:28             247                 Sem vítima 269,670
39206: 31/12/2022 19:53:19             571 ac02 - Acidente com Vítima 445,000
39207: 31/12/2022 16:29:00             343                 Sem vítima 643,000
39208: 31/12/2022 10:18:00             206        Acidente com vítima      44
          trecho     sentido              lugar_acidente
    1: BR-116/PR         Sul Autopista Regis Bittencourt
    2: BR-101/SC       Norte       Autopista Litoral Sul
    3: BR-116/SP   Pista Sul                   Novadutra
    4: BR-116/PR       Norte Autopista Regis Bittencourt
    5: BR-101/SC       Norte       Autopista Litoral Sul
   ---                                                  
39204: BR-101/SC Decrescente       Autopista Litoral Sul
39205: BR-116/SP   Crescente Autopista Regis Bittencourt
39206: BR-262/MG       Oeste                    Concebra
39207: BR-116/BA Decrescente                   Via Bahia
39208: BR-101/SP Pista Norte                       RIOSP
                       tipo_de_acidente automovel bicicleta caminhao moto
    1:                 Colisão Traseira         3        NA       NA   NA
    2:                 Colisão Traseira         3        NA       NA   NA
    3:    Choque em barreira New Jersey         3         0        0    0
    4:                    Engavetamento         4        NA       NA   NA
    5:                 Colisão Traseira         3        NA       NA   NA
   ---                                                                   
39204:                    Engavetamento         3         0        0    0
39205:                    Engavetamento         3         0        0    0
39206:                  Colisão Lateral         3         0        0    0
39207: Colisão lateral no mesmo sentido         0         0        3    0
39208:                    Engavetamento         3         0        0    0
       onibus outros tracao_animal transporte_de_cargas_especiais
    1:     NA     NA            NA                             NA
    2:     NA     NA            NA                             NA
    3:      0      0             0                             NA
    4:     NA     NA            NA                             NA
    5:     NA     NA            NA                             NA
   ---                                                           
39204:      0      0             0                              0
39205:      0      0             0                              0
39206:      0      0             0                              0
39207:      0      0             0                              0
39208:      0      0             0                             NA
       trator_maquinas utilitarios ilesos levemente_feridos
    1:              NA          NA     14                NA
    2:              NA          NA      3                NA
    3:               0           0     11                 0
    4:              NA          NA      7                NA
    5:              NA          NA      3                NA
   ---                                                     
39204:               0           0      3                 0
39205:               0           1      4                 0
39206:               0           0      2                 0
39207:               0           0      0                 0
39208:               0           0     10                 1
       moderadamente_feridos gravemente_feridos mortos
    1:                    NA                 NA     NA
    2:                    NA                 NA     NA
    3:                     0                  0      0
    4:                    NA                 NA     NA
    5:                    NA                 NA     NA
   ---                                                
39204:                     0                  0      0
39205:                     0                  0      0
39206:                     0                  0      0
39207:                     0                  0      0
39208:                     0                  0      0</code></pre>
</div>
</div>
</section><section id="filtrando-valores-dentro-de-um-intervalo" class="level4"><h4 class="anchored" data-anchor-id="filtrando-valores-dentro-de-um-intervalo">4.2.2.3 Filtrando valores dentro de um intervalo</h4>
<p>Para filtramos valores dentro de um intervalo definido podemos utilizar as funções <code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code> e <code>%in%</code>.</p>
<p>A função <code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code> é útil para filtrar valores dentro de um intervalo numérico.</p>
<p>Podemos estar interessados em filtrar as observações com valores entre 4 e 8 motos envolvidas no acidente:</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">moto</span>, lower <span class="op">=</span> <span class="fl">4</span>, upper <span class="op">=</span> <span class="fl">8</span>, incbounds <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          data  horario n_da_ocorrencia                    tipo_de_ocorrencia
 1: 02/02/2012 09:07:00              35                            sem vítima
 2: 02/08/2022 14:34:00             333          Acidente com Danos Materiais
 3: 04/02/2021 06:24:00             111                  Acidente sem Vítimas
 4: 05/08/2021 07:12:00             118                  Acidente com Vítimas
 5: 07/08/2021 04:53:00              35                  Acidente com Vítimas
 6: 09/07/2021 06:08:00              70                  Acidente com Vítimas
 7: 11/04/2019 23:50:00             526                            com vítima
 8: 11/07/2017 16:31:00             307                            com vítima
 9: 13/11/2016 17:15:00             146                            sem vítima
10: 14/01/2021 06:55:00             143                  Acidente com Vítimas
11: 16/11/2010 21:22:00             404                            com vítima
12: 17/03/2016 06:52:00              64                   Acidente com vítima
13: 18/03/2016 17:02:00             259                   Acidente sem Vítima
14: 18/07/2021 09:06:00              88                  Acidente sem Vítimas
15: 19/03/2016 05:23:00              70 Acidente sem Vítima - TRECHO CONTORNO
16: 19/10/2020 18:40:00             240                        Acidente Fatal
17: 20/03/2016 18:20:00             249                   Acidente com vítima
18: 20/03/2021 22:17:00             245                  Acidente com Vítimas
19: 20/03/2021 13:57:00             140                        Acidente Fatal
20: 20/05/2016 07:50:00             110                            com vítima
21: 20/10/2021 06:30:00             114                  Acidente com Vítimas
22: 21/03/2016 08:54:00             103                   Acidente com vítima
23: 22/01/2023 19:40:00            3192      AC01 - Acidente com VITIMA FATAL
24: 22/03/2016 23:01:00             347                   Acidente sem Vítima
25: 22/11/2015 10:04:00              61                            com vítima
26: 23/01/2023 14:50:00              69                            Com vítima
27: 25/03/2013 07:31:00             158                            com vítima
28: 25/09/2021 06:50:00              66                  Acidente com Vítimas
29: 26/08/2011 22:27:00             817                            com vítima
30: 27/10/2021 12:33:00             208                  Acidente com Vítimas
31: 28/03/2020 12:30:00             249                            com vítima
32: 29/03/2021 23:48:00             289                  Acidente com Vítimas
          data  horario n_da_ocorrencia                    tipo_de_ocorrencia
                  km    trecho     sentido              lugar_acidente
 1:             59,7 BR-153/SP       Norte             Transbrasiliana
 2:          506,000 BR-153/GO         Sul                    Concebra
 3:            510,3 BR-040/MG         Sul                      VIA040
 4:            96,99 BR-040/GO         Sul                      VIA040
 5:           552,15 BR-040/MG         Sul                      VIA040
 6:            514,4 BR-040/MG         Sul                      VIA040
 7:          212,269 BR-101/SC         Sul       Autopista Litoral Sul
 8:            269,5 BR-116/PR         Sul Autopista Regis Bittencourt
 9:              0,2 BR-050/MG       Norte                      ECO050
10:           542,25 BR-040/MG         Sul                      VIA040
11: 90,0999984741211 BR-381/SP       Norte       Autopista Fernão Dias
12:              401 BR-101/ES         Sul                      ECO101
13:              205 BR-101/ES       Norte                      ECO101
14:              4,1 BR-040/GO       Norte                      VIA040
15:              285 BR-101/ES         Sul                      ECO101
16:           610,55 BR-040/MG         Sul                      VIA040
17:              139 BR-101/ES         Sul                      ECO101
18:             23,1 BR-040/GO       Norte                      VIA040
19:             34,6 BR-040/MG         Sul                      VIA040
20:          207,488 BR-101/SC       Norte       Autopista Litoral Sul
21:            517,5 BR-040/MG         Sul                      VIA040
22:              363 BR-101/ES         Sul                      ECO101
23:              822 BR-040/MG          JF                      Concer
24:               10 BR-101/ES       Norte                      ECO101
25:            277,7 BR-101/RJ         Sul        Autopista Fluminense
26:           80,200 BR-392/RS   Crescente                      Ecosul
27:            180,2 BR-116/RJ Pista Norte                   Novadutra
28:              5,5 BR-040/DF       Norte                      VIA040
29:            153,4 BR-116/SP Pista Norte                   Novadutra
30:           531,12 BR-040/MG         Sul                      VIA040
31:           24,926 BR-101/SC         Sul       Autopista Litoral Sul
32:              8,9 BR-040/MG         Sul                      VIA040
                  km    trecho     sentido              lugar_acidente
                              tipo_de_acidente automovel bicicleta caminhao
 1: Choque contra objeto na faixa de rolamento        NA        NA        1
 2:                           Colisão Traseira         0         0        0
 3:                              Engavetamento         0         0        0
 4:                           Colisão traseira         0         0        0
 5:                           Colisão traseira         0         0        0
 6:                              Engavetamento         4         0        0
 7:                              Engavetamento         1        NA       NA
 8:                        Colisão Transversal         1         0        0
 9:     Choque - Veiculo parado no acostamento         1        NA       NA
10:                           Colisão traseira         0         0        0
11:                         Outros - Sequência        NA        NA       NA
12:                            Colisão Lateral         1        NA        0
13:                           Colisão Traseira         2        NA        0
14:                            Colisão lateral         0         0        0
15:                             Saída de Pista         2        NA        0
16:                        Colisão transversal         0         0        1
17:                           Colisão Traseira         1        NA        0
18:                              Engavetamento         1         0        0
19:                            Colisão frontal         0         0        1
20:                              Engavetamento        NA        NA       NA
21:                            Colisão lateral         2         0        0
22:                            Colisão Lateral         0        NA        1
23:                     Atropelamento - Animal        NA        NA       NA
24:                          Veículo em Chamas         0        NA        0
25:                              Engavetamento         1        NA       NA
26:                             Saída de pista         0         0        0
27:                  Abalroamento longitudinal         1         0        0
28:                         Tombamento de Moto         0         0        0
29:                              Queda de moto         0         0        0
30:                            Colisão lateral         0         0        0
31:                              Engavetamento         1        NA       NA
32:                           Colisão traseira         2         0        0
                              tipo_de_acidente automovel bicicleta caminhao
    moto onibus outros tracao_animal transporte_de_cargas_especiais
 1:    4     NA     NA            NA                             NA
 2:    4      0      0             0                              0
 3:    5      0      1             0                              0
 4:    4      0      0             0                              0
 5:    4      0      1             0                              0
 6:    4      0      0             0                              0
 7:    4     NA     NA            NA                             NA
 8:    4      0      0             0                              0
 9:    4     NA     NA            NA                             NA
10:    4      0      0             0                              0
11:    4     NA     NA            NA                             NA
12:    5      0      0             0                             NA
13:    4      0      0             0                             NA
14:    5      0      0             0                              0
15:    4      0      0             0                             NA
16:    6      0      0             0                              0
17:    4      0      0             0                             NA
18:    4      0      0             0                              0
19:    4      2      0             0                              0
20:    4     NA      1            NA                             NA
21:    4      0      0             0                              0
22:    4      0      0             0                             NA
23:    4     NA     NA            NA                             NA
24:    4      0      0             0                             NA
25:    5     NA     NA            NA                             NA
26:    5      0      0             0                              0
27:    4      0      0             0                             NA
28:    4      0      1             0                              0
29:    4      0      0             0                             NA
30:    4      0      0             0                              0
31:    4     NA     NA            NA                             NA
32:    4      0      0             0                              0
    moto onibus outros tracao_animal transporte_de_cargas_especiais
    trator_maquinas utilitarios ilesos levemente_feridos moderadamente_feridos
 1:              NA          NA      5                NA                    NA
 2:               0           0      4                 0                     0
 3:               0           0      3                 0                     0
 4:               0           0      1                 0                     1
 5:               0           0      0                 0                     0
 6:               0           0      0                 1                     0
 7:              NA          NA      1                 2                    NA
 8:               0           0      1                 4                     0
 9:              NA          NA      6                NA                    NA
10:               0           0      2                 1                     0
11:              NA          NA      4                 1                    NA
12:              NA          NA      2                 0                     0
13:              NA          NA      5                 0                     0
14:               0           0      2                 0                     0
15:              NA          NA      4                 0                     0
16:               0           0      1                 0                     0
17:              NA          NA      2                 2                     0
18:               0           0      2                 0                     0
19:               0           0      1                 0                     0
20:              NA          NA      3                 2                    NA
21:               0           0      0                 1                     0
22:              NA          NA      2                 1                     0
23:              NA          NA      1                 2                    NA
24:              NA          NA      1                 0                     0
25:              NA          NA      4                 1                     2
26:               0           0      3                 1                     0
27:               0           0      2                 4                     0
28:               0           0      3                 0                     1
29:               0           0      2                 2                     0
30:               0           0      0                 1                     0
31:              NA          NA      3                 2                    NA
32:               0           0      1                 1                     0
    trator_maquinas utilitarios ilesos levemente_feridos moderadamente_feridos
    gravemente_feridos mortos
 1:                 NA     NA
 2:                  0      0
 3:                  0      0
 4:                  0      0
 5:                  0      0
 6:                  0      0
 7:                  1      1
 8:                  0      0
 9:                 NA     NA
10:                  0      0
11:                 NA     NA
12:                  1      0
13:                  0      0
14:                  0      0
15:                  0      0
16:                  0      1
17:                  0      0
18:                  0      0
19:                  0      1
20:                 NA     NA
21:                  0      0
22:                  0      0
23:                  1      1
24:                  0      0
25:                 NA     NA
26:                  1      0
27:                  0      0
28:                  0      0
29:                  0      0
30:                  0      0
31:                 NA     NA
32:                  0      0
    gravemente_feridos mortos</code></pre>
</div>
</div>
<p>A função <code>%in%</code> é usada para filtrar valores que correspondem a um conjunto de valores.</p>
<p>Podemos estar interessados em filtrar as observações com ocorrência em alguma das seguintes operadoras: “Autopista Regis Bittencourt”, “Autopista Litoral Sul”, “Via Sul”.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">autopistas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Autopista Regis Bittencourt"</span>, <span class="st">"Autopista Litoral Sul"</span>, <span class="st">"Via Sul"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lugar_acidente</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">autopistas</span><span class="op">)</span> </span>
<span><span class="va">dados_filtrados</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              data  horario n_da_ocorrencia tipo_de_ocorrencia      km
     1: 01/01/2010 02:13:00              20         sem vítima   269,5
     2: 01/01/2010 11:20:00             125         sem vítima      52
     3: 01/01/2010 18:07:00             214         sem vítima      40
     4: 01/01/2010 15:52:00             354         sem vítima     132
     5: 01/01/2010 16:30:00             377         com vítima      35
    ---                                                               
203032: 31/12/2022 20:44:02             343         Com vítima 105,500
203033: 31/12/2022 22:20:07             372         Sem vítima 158,100
203034: 31/12/2022 22:16:59             369         Com vítima 131,163
203035: 31/12/2022 23:23:36             386         Sem vítima 146,425
203036: 31/12/2022 12:12:09             188         Com vítima 223,520
           trecho     sentido              lugar_acidente tipo_de_acidente
     1: BR-116/PR         Sul Autopista Regis Bittencourt Colisão Traseira
     2: BR-116/PR       Norte Autopista Regis Bittencourt   Saida de Pista
     3: BR-116/PR         Sul Autopista Regis Bittencourt   Saida de Pista
     4: BR-101/SC         Sul       Autopista Litoral Sul   Saida de Pista
     5: BR-101/SC         Sul       Autopista Litoral Sul    Queda de Moto
    ---                                                                   
203032: BR-116/SC   Crescente       Autopista Litoral Sul Colisão traseira
203033: BR-101/SC   Crescente       Autopista Litoral Sul Colisão traseira
203034: BR-101/SC   Crescente       Autopista Litoral Sul    Queda de moto
203035: BR-101/SC   Crescente       Autopista Litoral Sul           Choque
203036: BR-101/SC Decrescente       Autopista Litoral Sul    Queda de moto
        automovel bicicleta caminhao moto onibus outros tracao_animal
     1:         2        NA       NA   NA     NA     NA            NA
     2:         1        NA       NA   NA     NA     NA            NA
     3:         1        NA       NA   NA     NA     NA            NA
     4:         1        NA       NA   NA     NA     NA            NA
     5:        NA        NA       NA    1     NA     NA            NA
    ---                                                              
203032:         1         0        0    1      0      0             0
203033:         2         0        0    0      0      0             0
203034:         0         0        0    1      0      0             0
203035:         1         0        0    0      0      0             0
203036:         0         0        0    1      0      0             0
        transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
     1:                             NA              NA          NA      3
     2:                             NA              NA          NA      3
     3:                             NA              NA          NA      4
     4:                             NA              NA          NA      1
     5:                             NA              NA          NA      0
    ---                                                                  
203032:                              0               0           0      1
203033:                              0               0           0      2
203034:                              0               0           0      0
203035:                              0               0           0      0
203036:                              0               0           0      0
        levemente_feridos moderadamente_feridos gravemente_feridos mortos
     1:                NA                    NA                 NA     NA
     2:                NA                    NA                 NA     NA
     3:                NA                    NA                 NA     NA
     4:                NA                    NA                 NA     NA
     5:                 2                    NA                 NA     NA
    ---                                                                  
203032:                 1                     0                  0      0
203033:                 0                     0                  0      0
203034:                 1                     0                  0      0
203035:                 0                     0                  0      0
203036:                 2                     0                  0      0</code></pre>
</div>
</div>
<p>Podemos estar interessados nas autopistas que não são operadas pelas mesmas operadoras. Para isso precisamos definir um operador de <em>not in</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">`%ni%`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span><span class="op">(</span><span class="va">`%in%`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dados_filtrados</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lugar_acidente</span> <span class="op">%ni%</span> <span class="va">autopistas</span><span class="op">)</span> </span>
<span><span class="va">dados_filtrados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              data  horario n_da_ocorrencia           tipo_de_ocorrencia
     1: 01/01/2010 04:21:00              18                   sem vítima
     2: 01/01/2010 03:35:00     000024/2010                   sem vítima
     3: 01/01/2010 07:31:00     000038/2010                   sem vítima
     4: 01/01/2010 04:57:00     000027/2010                   sem vítima
     5: 01/01/2010 08:02:00     000042/2010                   sem vítima
    ---                                                                 
661521: 31/12/2022 02:10:00              17 Acidente com Danos Materiais
661522: 31/12/2022 00:08:00               4 Acidente com Danos Materiais
661523: 31/12/2022 03:28:00              21                   Com vítima
661524: 31/12/2022 05:05:55              14                   Sem vítima
661525: 31/12/2022 13:49:33             339 Acidente com Danos Materiais
             km    trecho     sentido         lugar_acidente tipo_de_acidente
     1:     167 BR-393/RJ       Norte         Rodovia do Aço       Derrapagem
     2:      77 BR-290/RS       Norte                Concepa  COLISÃO LATERAL
     3:      52 BR-116/RS       Norte                Concepa    QUEDA DE MOTO
     4:      33 BR-290/RS       Norte                Concepa    QUEDA DE MOTO
     5:      24 BR-290/RS         Sul                Concepa   SAÍDA DE PISTA
    ---                                                                      
661521: 636,000 BR-262/MG       Leste               Concebra   Saida de Pista
661522: 865,000 BR-262/MG       Oeste               Concebra   Saida de Pista
661523: 180,000  BR-50/MG Decrescente                 ECO050      Capotamento
661524: 115,100 BR-116/PR Decrescente Autopista Planalto Sul Colisão traseira
661525: 379,000 BR-262/MG       Leste               Concebra   Saida de Pista
        automovel bicicleta caminhao moto onibus outros tracao_animal
     1:         1        NA       NA   NA     NA     NA            NA
     2:         2         0        0    0      0      0             0
     3:         0         0        0    1      0      0             0
     4:         0         0        0    1      0      0             0
     5:         1         0        0    0      0      0             0
    ---                                                              
661521:         1         0        0    0      0      0             0
661522:         1         0        0    0      0      0             0
661523:         1         0        0    0      0      0             0
661524:         2         0        0    0      0      0             0
661525:         0         0        1    0      0      0             0
        transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
     1:                             NA              NA          NA      1
     2:                              0               0           0      2
     3:                              0               0           0      1
     4:                              0               0           0      1
     5:                              0               0           0      1
    ---                                                                  
661521:                              0               0           0      3
661522:                              0               0           0      1
661523:                              0               0           0      3
661524:                              0               0           0      2
661525:                              0               0           0      1
        levemente_feridos moderadamente_feridos gravemente_feridos mortos
     1:                 0                     0                  0      0
     2:                 0                     0                  0      0
     3:                 0                     0                  0      0
     4:                 0                     0                  0      0
     5:                 0                     0                  0      0
    ---                                                                  
661521:                 0                     0                  0      0
661522:                 0                     0                  0      0
661523:                 1                     0                  0      0
661524:                 0                     0                  0      0
661525:                 0                     0                  0      0</code></pre>
</div>
</div>
<p>Alternativamente,</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">lugar_acidente</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">autopistas</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              data  horario n_da_ocorrencia           tipo_de_ocorrencia
     1: 01/01/2010 04:21:00              18                   sem vítima
     2: 01/01/2010 03:35:00     000024/2010                   sem vítima
     3: 01/01/2010 07:31:00     000038/2010                   sem vítima
     4: 01/01/2010 04:57:00     000027/2010                   sem vítima
     5: 01/01/2010 08:02:00     000042/2010                   sem vítima
    ---                                                                 
661521: 31/12/2022 02:10:00              17 Acidente com Danos Materiais
661522: 31/12/2022 00:08:00               4 Acidente com Danos Materiais
661523: 31/12/2022 03:28:00              21                   Com vítima
661524: 31/12/2022 05:05:55              14                   Sem vítima
661525: 31/12/2022 13:49:33             339 Acidente com Danos Materiais
             km    trecho     sentido         lugar_acidente tipo_de_acidente
     1:     167 BR-393/RJ       Norte         Rodovia do Aço       Derrapagem
     2:      77 BR-290/RS       Norte                Concepa  COLISÃO LATERAL
     3:      52 BR-116/RS       Norte                Concepa    QUEDA DE MOTO
     4:      33 BR-290/RS       Norte                Concepa    QUEDA DE MOTO
     5:      24 BR-290/RS         Sul                Concepa   SAÍDA DE PISTA
    ---                                                                      
661521: 636,000 BR-262/MG       Leste               Concebra   Saida de Pista
661522: 865,000 BR-262/MG       Oeste               Concebra   Saida de Pista
661523: 180,000  BR-50/MG Decrescente                 ECO050      Capotamento
661524: 115,100 BR-116/PR Decrescente Autopista Planalto Sul Colisão traseira
661525: 379,000 BR-262/MG       Leste               Concebra   Saida de Pista
        automovel bicicleta caminhao moto onibus outros tracao_animal
     1:         1        NA       NA   NA     NA     NA            NA
     2:         2         0        0    0      0      0             0
     3:         0         0        0    1      0      0             0
     4:         0         0        0    1      0      0             0
     5:         1         0        0    0      0      0             0
    ---                                                              
661521:         1         0        0    0      0      0             0
661522:         1         0        0    0      0      0             0
661523:         1         0        0    0      0      0             0
661524:         2         0        0    0      0      0             0
661525:         0         0        1    0      0      0             0
        transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
     1:                             NA              NA          NA      1
     2:                              0               0           0      2
     3:                              0               0           0      1
     4:                              0               0           0      1
     5:                              0               0           0      1
    ---                                                                  
661521:                              0               0           0      3
661522:                              0               0           0      1
661523:                              0               0           0      3
661524:                              0               0           0      2
661525:                              0               0           0      1
        levemente_feridos moderadamente_feridos gravemente_feridos mortos
     1:                 0                     0                  0      0
     2:                 0                     0                  0      0
     3:                 0                     0                  0      0
     4:                 0                     0                  0      0
     5:                 0                     0                  0      0
    ---                                                                  
661521:                 0                     0                  0      0
661522:                 0                     0                  0      0
661523:                 1                     0                  0      0
661524:                 0                     0                  0      0
661525:                 0                     0                  0      0</code></pre>
</div>
</div>
<p>Outras vezes, podemos utilizar o operador <code>%like%</code> que busca padrões. Por exemplo, podemos estar interessados em buscar todos acidentes que ocorreram com vítimas, e no campo <code>tipo_de_ocorrencia</code> podemos simplesmente buscar por:</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tipo_de_ocorrencia</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/like.html">%like%</a></span> <span class="st">"com vítima"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              data  horario n_da_ocorrencia               tipo_de_ocorrencia
     1: 01/01/2010 15:53:00              48                       com vítima
     2: 01/01/2010 16:30:00             377                       com vítima
     3: 01/01/2010 01:06:00               2                       com vítima
     4: 01/01/2010 11:25:00             102                       com vítima
     5: 01/01/2010 12:41:00             142                       com vítima
    ---                                                                     
219209: 31/12/2022 10:28:00             211              Acidente com vítima
219210: 31/12/2022 07:53:44              26 ac03 - Acidente com vítima ilesa
219211: 31/12/2022 10:18:00             206              Acidente com vítima
219212: 31/12/2022 01:53:24              10 ac03 - Acidente com vítima ilesa
219213: 31/12/2022 07:53:44              26 ac03 - Acidente com vítima ilesa
             km    trecho     sentido              lugar_acidente
     1:   119,5 BR-116/PR         Sul      Autopista Planalto Sul
     2:      35 BR-101/SC         Sul       Autopista Litoral Sul
     3:     114 BR-040/RJ         Sul                      Concer
     4:      64 BR-381/SP         Sul       Autopista Fernão Dias
     5:     273 BR-116/PR       Norte Autopista Regis Bittencourt
    ---                                                          
219209:     144 BR-116/SP   Pista Sul                       RIOSP
219210: 118,572 BR-116/RJ         Sul                 Ecoriominas
219211:      44 BR-101/SP Pista Norte                       RIOSP
219212:    39,9 BR-116/RJ         Sul                 Ecoriominas
219213: 118,572 BR-116/RJ         Sul                 Ecoriominas
            tipo_de_acidente automovel bicicleta caminhao moto onibus outros
     1:  Colisão Transversal         2        NA       NA   NA     NA     NA
     2:        Queda de Moto        NA        NA       NA    1     NA     NA
     3: Choque - Objeto Fixo         1        NA       NA   NA     NA     NA
     4:          Capotamento         1        NA       NA   NA     NA     NA
     5:      Colisão Lateral        NA        NA       NA    1      1     NA
    ---                                                                     
219209:        Queda de moto         0         0        0    1      0      0
219210:       Saida de Pista         1        NA       NA   NA     NA     NA
219211:        Engavetamento         3         0        0    0      0      0
219212:          Capotamento         1        NA       NA   NA     NA     NA
219213:       Saida de Pista         1        NA       NA   NA     NA     NA
        tracao_animal transporte_de_cargas_especiais trator_maquinas
     1:            NA                             NA              NA
     2:            NA                             NA              NA
     3:            NA                             NA              NA
     4:            NA                             NA              NA
     5:            NA                             NA              NA
    ---                                                             
219209:             0                             NA               0
219210:            NA                             NA              NA
219211:             0                             NA               0
219212:            NA                             NA              NA
219213:            NA                             NA              NA
        utilitarios ilesos levemente_feridos moderadamente_feridos
     1:          NA      4                 5                    NA
     2:          NA      0                 2                    NA
     3:          NA      0                 2                    NA
     4:          NA      0                 1                    NA
     5:          NA      2                NA                     1
    ---                                                           
219209:           0      0                 1                     0
219210:          NA      1                NA                    NA
219211:           0     10                 1                     0
219212:          NA      1                NA                    NA
219213:          NA      1                NA                    NA
        gravemente_feridos mortos
     1:                 NA     NA
     2:                 NA     NA
     3:                 NA     NA
     4:                 NA     NA
     5:                 NA     NA
    ---                          
219209:                  0      0
219210:                 NA     NA
219211:                  0      0
219212:                 NA     NA
219213:                 NA     NA</code></pre>
</div>
</div>
<p>Algumas vezes temos apenas vários padrões de texto que gostaríamos de buscar. Para isso, a função <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> permite filtrar com base em padrões de texto.</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ilesa|fatal"</span>, <span class="va">tipo_de_ocorrencia</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            data  horario n_da_ocorrencia               tipo_de_ocorrencia
   1: 01/01/2021 04:46:54              23 ac03 - Acidente com vítima ilesa
   2: 01/01/2021 14:00:09              83 ac03 - Acidente com vítima ilesa
   3: 01/01/2023 12:34:00              58 ac03 - Acidente com vítima ilesa
   4: 01/01/2023 16:39:20              90 ac03 - Acidente com vítima ilesa
   5: 01/01/2023 17:19:19              95 ac03 - Acidente com vítima ilesa
  ---                                                                     
2001: 31/12/2022 01:53:24              10 ac03 - Acidente com vítima ilesa
2002: 31/12/2022 04:50:18              17 ac03 - Acidente com vítima ilesa
2003: 31/12/2022 07:53:44              26 ac03 - Acidente com vítima ilesa
2004: 31/12/2022 01:53:24              10 ac03 - Acidente com vítima ilesa
2005: 31/12/2022 07:53:44              26 ac03 - Acidente com vítima ilesa
           km    trecho sentido lugar_acidente                 tipo_de_acidente
   1:   163,2 BR-050/GO   Norte         ECO050          Atropelamento de Animal
   2:    37,8 BR-050/MG     Sul         ECO050        Choque - Defensa metálica
   3:  17,781 BR-116/RJ     Sul    Ecoriominas                  Choque - Arvore
   4:      42 BR-116/RJ     Sul    Ecoriominas Colisão lateral no mesmo sentido
   5:     109 BR-116/RJ   Norte    Ecoriominas Colisão lateral no mesmo sentido
  ---                                                                          
2001:    39,9 BR-116/RJ     Sul    Ecoriominas                      Capotamento
2002:    54,3 BR-493/RJ   Norte    Ecoriominas                   Choque - Poste
2003: 118,572 BR-116/RJ     Sul    Ecoriominas                   Saida de Pista
2004:    39,9 BR-116/RJ     Sul    Ecoriominas                      Capotamento
2005: 118,572 BR-116/RJ     Sul    Ecoriominas                   Saida de Pista
      automovel bicicleta caminhao moto onibus outros tracao_animal
   1:         1        NA       NA   NA     NA     NA            NA
   2:         1        NA       NA   NA     NA     NA            NA
   3:        NA        NA        1   NA     NA     NA            NA
   4:         2        NA       NA   NA     NA     NA            NA
   5:         1        NA       NA   NA     NA      1            NA
  ---                                                              
2001:         1        NA       NA   NA     NA     NA            NA
2002:        NA        NA        1   NA     NA     NA            NA
2003:         1        NA       NA   NA     NA     NA            NA
2004:         1        NA       NA   NA     NA     NA            NA
2005:         1        NA       NA   NA     NA     NA            NA
      transporte_de_cargas_especiais trator_maquinas utilitarios ilesos
   1:                             NA              NA          NA      1
   2:                             NA              NA          NA      2
   3:                             NA              NA          NA      1
   4:                             NA              NA          NA      4
   5:                             NA              NA          NA      2
  ---                                                                  
2001:                             NA              NA          NA      1
2002:                             NA              NA          NA      1
2003:                             NA              NA          NA      1
2004:                             NA              NA          NA      1
2005:                             NA              NA          NA      1
      levemente_feridos moderadamente_feridos gravemente_feridos mortos
   1:                NA                    NA                 NA     NA
   2:                NA                    NA                 NA     NA
   3:                NA                    NA                 NA     NA
   4:                NA                    NA                 NA     NA
   5:                NA                    NA                 NA     NA
  ---                                                                  
2001:                NA                    NA                 NA     NA
2002:                NA                    NA                 NA     NA
2003:                NA                    NA                 NA     NA
2004:                NA                    NA                 NA     NA
2005:                NA                    NA                 NA     NA</code></pre>
</div>
</div>
</section></section><section id="resumo-de-informações" class="level3"><h3 class="anchored" data-anchor-id="resumo-de-informações">4.2.3 Resumo de informações</h3>
<p>No tidyverse, as funções <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> são amplamente utilizadas para resumir informações e realizar cálculos agregados em conjuntos de dados. Elas desempenham um papel crucial na análise exploratória e na obtenção de insights significativos a partir dos dados. Vamos explorar como essas funções funcionam e como usá-las para resumir informações de maneira eficaz.</p>
<section id="função-summarise" class="level4"><h4 class="anchored" data-anchor-id="função-summarise">4.2.3.1 Função <code>summarise()</code>
</h4>
<p>A função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> é utilizada para calcular estatísticas resumidas para uma coluna ou um conjunto de colunas. Ela permite calcular médias, somas, desvios padrão, mínimos, máximos e outras estatísticas relevantes.</p>
<p>Estamos interessados em uma tabela descritiva para a variável <code>levemente_feridos</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tabela</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>              f_r <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span>, </span>
<span>              f_per <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>              media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.25</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.5</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.75</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              sd  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">tabela</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       n f_r f_per     media Q1 Q2 Q3      var       sd min max
1 864561   1   100 0.6814294  0  0  1 1.009796 1.004886   0  51</code></pre>
</div>
</div>
</section><section id="agrupamento-de-dados" class="level4"><h4 class="anchored" data-anchor-id="agrupamento-de-dados">4.2.3.2 Agrupamento de dados</h4>
<p>A função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> é usada para agrupar o conjunto de dados por uma ou mais colunas. Isso cria um contexto em que a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> pode calcular estatísticas específicas para cada grupo.</p>
<p>Estamos interessados em uma tabela descritiva para a variável <code>levemente_feridos</code> por <code>tipo_de_ocorrencia</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tabela</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>              f_r <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span>, </span>
<span>              f_per <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>              media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.25</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.5</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              Q3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.75</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              sd  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>              max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">tabela</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       n f_r f_per     media Q1 Q2 Q3      var       sd min max
1 864561   1   100 0.6814294  0  0  1 1.009796 1.004886   0  51</code></pre>
</div>
</div>
</section></section></section><section id="exercício" class="level2"><h2 class="anchored" data-anchor-id="exercício">4.3 Exercício</h2>
<ol type="1">
<li>Utilizando o banco de dados <code>starwars</code> faça o que se pede:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
6 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<ol type="a">
<li>Qual é o número total de espécies únicas presentes? Qual a frequência de indivíduos por espécie?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcule o número total de espécies únicas presentes</span></span>
<span><span class="va">num_species</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcule a frequência de indivíduos por espécie</span></span>
<span><span class="va">species_frequency</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>frequency <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exiba os resultados</span></span>
<span><span class="va">num_species</span>  <span class="co"># Número total de espécies únicas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 38</code></pre>
</div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">species_frequency</span>  <span class="co"># Frequência de indivíduos por espécie</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
   species   frequency
   &lt;chr&gt;         &lt;int&gt;
 1 Aleena            1
 2 Besalisk          1
 3 Cerean            1
 4 Chagrian          1
 5 Clawdite          1
 6 Droid             6
 7 Dug               1
 8 Ewok              1
 9 Geonosian         1
10 Gungan            3
# ℹ 28 more rows</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>Calcule a altura média de personagens masculinos e femininos.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">height_gender</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>altura_media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">height</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">height_gender</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender    altura_media
  &lt;chr&gt;            &lt;dbl&gt;
1 feminine          166.
2 masculine         181.</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>Qual é a média de idade dos personagens de cada espécie para personagens masculinos?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">media_idade</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"masculine"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>media_idade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">birth_year</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">media_idade</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 2
   species   media_idade
   &lt;chr&gt;           &lt;dbl&gt;
 1 Aleena          NaN  
 2 Besalisk        NaN  
 3 Cerean           92  
 4 Chagrian        NaN  
 5 Droid            53.3
 6 Dug             NaN  
 7 Ewok              8  
 8 Geonosian       NaN  
 9 Gungan           52  
10 Human            55.2
# ℹ 23 more rows</code></pre>
</div>
</div>
<ol start="4" type="a">
<li>Para cada espécie presente na base de dados, identifique o personagem mais velho e sua idade correspondente.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">old_character</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">birth_year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># sem este filtro, especies com valores ausentes não vão aparecer</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">birth_year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">birth_year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>personagem <span class="op">=</span> <span class="va">name</span>,</span>
<span>            idade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">birth_year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">old_character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   species        personagem            idade
   &lt;chr&gt;          &lt;chr&gt;                 &lt;dbl&gt;
 1 Cerean         Ki-Adi-Mundi             92
 2 Droid          C-3PO                   112
 3 Ewok           Wicket Systri Warrick     8
 4 Gungan         Jar Jar Binks            52
 5 Human          Dooku                   102
 6 Hutt           Jabba Desilijic Tiure   600
 7 Kel Dor        Plo Koon                 22
 8 Mirialan       Luminara Unduli          58
 9 Mon Calamari   Ackbar                   41
10 Rodian         Greedo                   44
11 Trandoshan     Bossk                    53
12 Twi'lek        Ayla Secura              48
13 Wookiee        Chewbacca               200
14 Yoda's species Yoda                    896
15 Zabrak         Darth Maul               54
16 &lt;NA&gt;           Quarsh Panaka            62</code></pre>
</div>
</div>
</section><section id="manipulação-de-data-no-r" class="level2"><h2 class="anchored" data-anchor-id="manipulação-de-data-no-r">4.4 Manipulação de Data no R</h2>
<p>A transformação de strings em datas e a manipulação de datas são tarefas comuns em análise de dados. No R, existem várias funções e pacotes disponíveis para facilitar essas operações. Vamos explorar como realizar essas tarefas usando as funcionalidades básicas do R.</p>
<section id="transformando-strings-em-datas" class="level3"><h3 class="anchored" data-anchor-id="transformando-strings-em-datas">4.4.1 Transformando Strings em Datas</h3>
<p>Para transformar strings em datas, podemos utilizar a função <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>. Por exemplo:</p>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># String representando uma data</span></span>
<span><span class="va">data_string</span> <span class="op">&lt;-</span> <span class="st">"2023-08-21"</span></span>
<span></span>
<span><span class="co"># Transformando a string em data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">data_string</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exibindo a data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21"</code></pre>
</div>
</div>
<p>Também podemos especificar o formato da string de data usando o argumento <code>format</code>. Por exemplo:</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_string</span> <span class="op">&lt;-</span> <span class="st">"21/08/2023"</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">data_string</span>, </span>
<span>                format <span class="op">=</span> <span class="st">"%d/%m/%Y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21"</code></pre>
</div>
</div>
</section><section id="manipulação-de-datas" class="level3"><h3 class="anchored" data-anchor-id="manipulação-de-datas">4.4.2 Manipulação de Datas</h3>
<p>Após transformar strings em datas, podemos realizar várias operações de manipulação de datas. Algumas das operações mais comuns incluem:</p>
<ul>
<li>Adição e subtração de dias, semanas, meses ou anos:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">+</span> <span class="fl">7</span>  <span class="co"># Adicionando 7 dias</span></span>
<span><span class="va">data3</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">-</span> <span class="fl">1</span>  <span class="co"># Subtraindo 1 dia</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Comparação de datas:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-15"</span><span class="op">)</span></span>
<span><span class="va">data1</span> <span class="op">&gt;</span> <span class="va">data2</span>  <span class="co"># Verifica se data1 é posterior a data2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<ul>
<li>Formatação de datas para strings:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data_formatada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"%d/%m/%Y"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Extração de componentes de data (ano, mês, dia):</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">ano</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"%Y"</span><span class="op">)</span></span>
<span><span class="va">mes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"%m"</span><span class="op">)</span></span>
<span><span class="va">dia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"%d"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Cálculo de diferenças entre datas:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-08-15"</span><span class="op">)</span></span>
<span><span class="va">diferenca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>  <span class="co"># Diferença em dias</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="lubridate-facilitando-a-manipulação-de-datas-no-r" class="level3"><h3 class="anchored" data-anchor-id="lubridate-facilitando-a-manipulação-de-datas-no-r">4.4.3 Lubridate: Facilitando a Manipulação de Datas no R</h3>
<p>Lidar com datas no R pode ser uma tarefa desafiadora, especialmente quando se precisa realizar operações complexas ou extrair informações específicas das datas. O pacote <code>lubridate</code> foi desenvolvido para simplificar a manipulação de datas, tornando as tarefas relacionadas a datas mais fáceis e intuitivas. Vamos explorar algumas das principais funcionalidades do <code>lubridate</code> em mais detalhes, com exemplos práticos:</p>
<section id="instalação-e-carregamento-do-lubridate" class="level4"><h4 class="anchored" data-anchor-id="instalação-e-carregamento-do-lubridate">4.4.3.1 Instalação e Carregamento do Lubridate</h4>
<p>Antes de usar o <code>lubridate</code>, é necessário instalá-lo e carregá-lo no R. Para isso, utilize o comando <code>install.packages("lubridate")</code> para a instalação e <code><a href="https://lubridate.tidyverse.org">library(lubridate)</a></code> para o carregamento do pacote. Essas etapas devem ser executadas apenas uma vez.</p>
</section><section id="criando-datas" class="level4"><h4 class="anchored" data-anchor-id="criando-datas">4.4.3.2 Criando Datas</h4>
<p>O <code>lubridate</code> torna a criação de datas simples e flexível. Podemos criar datas usando diferentes funções, dependendo do formato dos seus dados. Além da já mencionada <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> para datas no formato “ano-mês-dia,” também podemos utilizar:</p>
<ul>
<li><p><code><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code> para datas no formato “mês-dia-ano.”</p></li>
<li><p><code><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy()</a></code> para datas no formato “dia-mês-ano.”</p></li>
</ul>
<p>Essas funções ajudam a evitar confusões em relação ao formato das datas, tornando o processo de entrada de dados mais seguro. Veja um exemplo:</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: lubridate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:data.table':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_ymd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data_mdy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"08-21-2023"</span><span class="op">)</span></span>
<span><span class="va">data_dmy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">"21-08-2023"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_ymd</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_mdy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_dmy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21"</code></pre>
</div>
</div>
</section><section id="operações-com-datas" class="level4"><h4 class="anchored" data-anchor-id="operações-com-datas">4.4.3.3 Operações com Datas</h4>
<p>Operações com datas, como adição e subtração de dias, semanas, meses ou anos, são realizadas de forma mais clara e intuitiva no <code>lubridate</code>. O pacote fornece funções específicas para isso, como <code><a href="https://lubridate.tidyverse.org/reference/period.html">days()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/period.html">weeks()</a></code>, <code><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months()</a></code>, e <code><a href="https://lubridate.tidyverse.org/reference/period.html">years()</a></code>. Isso permite que executemos operações como:</p>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data_nova</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>  <span class="co"># Adiciona 7 dias</span></span>
<span><span class="va">data_anterior</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># Subtrai 2 meses</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_nova</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-28"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_anterior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-06-21"</code></pre>
</div>
</div>
<p>Essa sintaxe simplificada torna as operações com datas mais legíveis e menos propensas a erros.</p>
</section><section id="extraindo-informações-de-datas" class="level4"><h4 class="anchored" data-anchor-id="extraindo-informações-de-datas">4.4.3.4 Extraindo Informações de Datas</h4>
<p>O <code>lubridate</code> permite extrair facilmente informações de datas. Com funções como <code><a href="https://lubridate.tidyverse.org/reference/year.html">year()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code>, e <code><a href="https://lubridate.tidyverse.org/reference/day.html">day()</a></code>, você pode obter o ano, mês ou dia de uma data específica. Além disso, é possível extrair informações mais detalhadas, como hora, minuto, e segundo, caso necessário. Isso é particularmente útil ao lidar com séries temporais ou análises de eventos temporais específicos. Veja exemplos:</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 15:30:45"</span><span class="op">)</span></span>
<span><span class="va">ano</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">mes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">dia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">day</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">hora</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">minuto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html">minute</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">segundo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/second.html">second</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ano</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2023</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">dia</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">hora</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">minuto</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">segundo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45</code></pre>
</div>
</div>
</section><section id="funções-de-resumo-de-datas" class="level4"><h4 class="anchored" data-anchor-id="funções-de-resumo-de-datas">4.4.3.5 Funções de Resumo de Datas</h4>
<p>O <code>lubridate</code> oferece funções que auxiliam na análise e resumo de datas. Podemos calcular a diferença entre duas datas com facilidade, obtendo o resultado em dias, semanas, meses ou anos. Isso é útil em cenários em que é preciso medir a duração entre eventos ou calcular intervalos de tempo:</p>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-08-21"</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-08-15"</span><span class="op">)</span></span>
<span><span class="va">diferenca_em_dias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data2</span> <span class="op">-</span> <span class="va">data1</span><span class="op">)</span></span>
<span><span class="va">diferenca_em_semanas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">weeks</a></span><span class="op">(</span><span class="va">data2</span> <span class="op">-</span> <span class="va">data1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">diferenca_em_dias</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">diferenca_em_semanas</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3628800</code></pre>
</div>
</div>
</section><section id="lidar-com-fusos-horários" class="level4"><h4 class="anchored" data-anchor-id="lidar-com-fusos-horários">4.4.3.6 Lidar com Fusos Horários</h4>
<p>Para situações que envolvem fusos horários, o <code>lubridate</code> facilita a manipulação, permitindo a converção de datas entre fusos e calcule diferenças de tempo em fusos diferentes. Isso é especialmente valioso em análises que abrangem regiões geográficas distintas ou quando é necessário considerar fusos horários em análises de eventos globais.</p>
<ul>
<li>Converter uma Data para um Fuso Horário Específico: Imagine que temos uma data em um fuso horário específico e desejamos convertê-la para outro fuso horário. O <code>lubridate</code> facilita essa tarefa usando a função <code><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz()</a></code>. Veja um exemplo:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Data original no fuso horário de Nova Iorque</span></span>
<span><span class="va">data_ny</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 12:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converter para o fuso horário de Londres</span></span>
<span><span class="va">data_london</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">data_ny</span>, tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_ny</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21 12:00:00 EDT"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data_london</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-08-21 17:00:00 BST"</code></pre>
</div>
</div>
<p>Neste exemplo, convertemos uma data de Nova Iorque para Londres.</p>
<ul>
<li>
<strong>Calcular a Diferença de Tempo entre Datas em Fusos Horários Diferentes</strong>:</li>
</ul>
<p>Calcular a diferença de tempo entre duas datas em fusos horários diferentes pode ser útil para determinar a sincronização de eventos em locais geograficamente distintos. O <code>lubridate</code> permite isso com facilidade:</p>
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Duas datas em fusos horários diferentes</span></span>
<span><span class="va">data_ny</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 12:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="va">data_london</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 17:00:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcular a diferença de tempo em horas</span></span>
<span><span class="va">diferenca_horas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_london</span> <span class="op">-</span> <span class="va">data_ny</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">diferenca_horas</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<ul>
<li>
<strong>Trabalhar com Fusos Horários em Data Frames</strong>: Em muitos casos, você pode ter um conjunto de dados com datas em diferentes fusos horários. O <code>lubridate</code> permite a manipulação desses dados em um Data Frame de forma eficiente. Suponha que temos um Data Frame chamado <code>dados</code> com datas em diferentes fusos horários:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  nome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Evento 1"</span>, <span class="st">"Evento 2"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 12:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2023-08-21 17:00:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converter todas as datas para um fuso horário comum, por exemplo, UTC</span></span>
<span><span class="va">dados</span><span class="op">$</span><span class="va">data_utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">dados</span><span class="op">$</span><span class="va">data</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">dados</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      nome                data            data_utc
1 Evento 1 2023-08-21 12:00:00 2023-08-21 16:00:00
2 Evento 2 2023-08-21 12:00:00 2023-08-21 16:00:00</code></pre>
</div>
</div>
<p>Neste exemplo, convertemos todas as datas no Data Frame para o fuso horário UTC, criando uma nova coluna chamada <code>data_utc</code>.</p>
<p>Lidar com fusos horários em análises de dados é fundamental para garantir que as informações temporais sejam precisas e consistentes, especialmente em cenários globais ou quando eventos ocorrem em locais diferentes ao redor do mundo. O pacote <code>lubridate</code> no R simplifica significativamente essa tarefa, tornando a manipulação de datas com fusos horários uma tarefa mais clara e eficiente.</p>
</section></section></section><section id="exercícios" class="level2"><h2 class="anchored" data-anchor-id="exercícios">4.5 Exercícios</h2>
<ol type="1">
<li>Utilizando o banco de dados <code>car_crash</code>:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Carregue as bibliotecas</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">car_crash</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./datasets/Brazil Total highway crashes 2010 - 2023.csv.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         data  horario n_da_ocorrencia tipo_de_ocorrencia    km    trecho
1: 01/01/2010 04:21:00              18         sem vítima   167 BR-393/RJ
2: 01/01/2010 02:13:00              20         sem vítima 269,5 BR-116/PR
3: 01/01/2010 03:35:00     000024/2010         sem vítima    77 BR-290/RS
4: 01/01/2010 07:31:00     000038/2010         sem vítima    52 BR-116/RS
5: 01/01/2010 04:57:00     000027/2010         sem vítima    33 BR-290/RS
6: 01/01/2010 08:02:00     000042/2010         sem vítima    24 BR-290/RS
   sentido              lugar_acidente tipo_de_acidente automovel bicicleta
1:   Norte              Rodovia do Aço       Derrapagem         1        NA
2:     Sul Autopista Regis Bittencourt Colisão Traseira         2        NA
3:   Norte                     Concepa  COLISÃO LATERAL         2         0
4:   Norte                     Concepa    QUEDA DE MOTO         0         0
5:   Norte                     Concepa    QUEDA DE MOTO         0         0
6:     Sul                     Concepa   SAÍDA DE PISTA         1         0
   caminhao moto onibus outros tracao_animal transporte_de_cargas_especiais
1:       NA   NA     NA     NA            NA                             NA
2:       NA   NA     NA     NA            NA                             NA
3:        0    0      0      0             0                              0
4:        0    1      0      0             0                              0
5:        0    1      0      0             0                              0
6:        0    0      0      0             0                              0
   trator_maquinas utilitarios ilesos levemente_feridos moderadamente_feridos
1:              NA          NA      1                 0                     0
2:              NA          NA      3                NA                    NA
3:               0           0      2                 0                     0
4:               0           0      1                 0                     0
5:               0           0      1                 0                     0
6:               0           0      1                 0                     0
   gravemente_feridos mortos
1:                  0      0
2:                 NA     NA
3:                  0      0
4:                  0      0
5:                  0      0
6:                  0      0</code></pre>
</div>
</div>
<ol type="a">
<li>formate a coluna data em uma <code>data</code> (dd-mm-yyyy)</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">data_formatada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                                    format <span class="op">=</span> <span class="st">"%d/%m/%Y"</span><span class="op">)</span></span>
<span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">data_formatada</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">data</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            data data_formatada
   1: 01/01/2010     2010-01-01
   2: 01/01/2011     2011-01-01
   3: 01/01/2012     2012-01-01
   4: 01/01/2013     2013-01-01
   5: 01/01/2014     2014-01-01
  ---                          
4947: 31/12/2018     2018-12-31
4948: 31/12/2019     2019-12-31
4949: 31/12/2020     2020-12-31
4950: 31/12/2021     2021-12-31
4951: 31/12/2022     2022-12-31</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>formate a coluna horario para o <code>horário</code> do acidente (hh:mm:ss)</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">horario_acidente</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">horario</span>, format <span class="op">=</span> <span class="st">"%H:%M:%S"</span><span class="op">)</span>, <span class="st">"%H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">horario</span>, <span class="va">horario_acidente</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">horario</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        horario horario_acidente
    1: 04:21:00         04:21:00
    2: 02:13:00         02:13:00
    3: 03:35:00         03:35:00
    4: 07:31:00         07:31:00
    5: 04:57:00         04:57:00
   ---                          
44265: 23:23:36         23:23:36
44266: 21:41:52         21:41:52
44267: 19:26:09         19:26:09
44268: 05:05:55         05:05:55
44269: 12:12:09         12:12:09</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>Qual o mês com maior quantidade de acidentes?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">mes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">data_formatada</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_c</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_c</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
     mes     n
   &lt;dbl&gt; &lt;int&gt;
 1    12 85308
 2     1 82507
 3    10 74716
 4     6 72276
 5    11 71677
 6     3 70696
 7     2 68783
 8     5 68626
 9     9 68586
10     7 68392
11     8 66596
12     4 66398</code></pre>
</div>
</div>
<ol start="4" type="a">
<li>Qual ano ocorreram mais acidentes?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">ano</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">data_formatada</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_d</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
     ano     n
   &lt;dbl&gt; &lt;int&gt;
 1  2015 74458
 2  2017 70107
 3  2016 70104
 4  2014 67816
 5  2019 64853
 6  2018 63970
 7  2020 62632
 8  2021 62498
 9  2012 61090
10  2013 60953
11  2011 60455
12  2022 56838
13  2010 54837
14  2023 33950</code></pre>
</div>
</div>
<ol start="5" type="a">
<li>Qual horário acontecem menos acidentes?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">hora</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">horario</span>, format <span class="op">=</span> <span class="st">"%H:%M"</span><span class="op">)</span>, <span class="st">"%H:%M"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_e</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hora</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_e</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,440 × 2
   hora      n
   &lt;chr&gt; &lt;int&gt;
 1 02:39   219
 2 01:56   220
 3 02:58   221
 4 03:04   221
 5 02:37   222
 6 02:43   227
 7 02:01   229
 8 02:32   229
 9 03:21   229
10 03:13   230
# ℹ 1,430 more rows</code></pre>
</div>
</div>
<ol start="6" type="a">
<li>Qual a média, desvio padrão, mediana, Q1 e Q3 para a quantidade de indivíduos classificados como levemente feridos por mês/ano?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">car_crash</span><span class="op">$</span><span class="va">mes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">mes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">car_crash</span><span class="op">$</span><span class="va">`mes/ano`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">car_crash</span><span class="op">$</span><span class="va">ano</span>, <span class="va">car_crash</span><span class="op">$</span><span class="va">mes</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questao_f</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">levemente_feridos</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">`mes/ano`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>            Q1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.25</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>            mediana <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.5</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>            Q3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, <span class="fl">0.75</span>, type <span class="op">=</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">levemente_feridos</span><span class="op">)</span>,</span>
<span>            max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">levemente_feridos</span><span class="op">)</span>,</span>
<span>            sd  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">levemente_feridos</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">questao_f</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 163 × 9
   `mes/ano`     n media    Q1 mediana    Q3   min   max    sd
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1 2010/01    1880 0.809     0       1     1     0    41 1.42 
 2 2010/02    1676 0.816     0       1     1     0    30 1.29 
 3 2010/03    1844 0.741     0       1     1     0    26 1.12 
 4 2010/04    1842 0.840     0       1     1     0     7 1.00 
 5 2010/05    2044 0.776     0       1     1     0    19 1.04 
 6 2010/06    1777 0.757     0       1     1     0    12 0.992
 7 2010/07    1929 0.802     0       1     1     0    21 1.25 
 8 2010/08    1776 0.819     0       1     1     0    51 1.52 
 9 2010/09    2119 0.748     0       1     1     0     9 0.977
10 2010/10    2030 0.807     0       1     1     0    39 1.29 
# ℹ 153 more rows</code></pre>
</div>
</div>
<ol start="7" type="a">
<li>Quantos acidentes com vítimas fatais aconteceram, por mês/ano, em mediana entre as 6:00am e 11:59am.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">questao_g</span> <span class="op">&lt;-</span> <span class="va">car_crash</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tipo_de_ocorrencia</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/like.html">%like%</a></span> <span class="st">"com vítima"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">hora</span>, <span class="st">"06:00"</span>, <span class="st">"11:59"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">`mes/ano`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">questao_g</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 159 × 2
   `mes/ano`     n
   &lt;chr&gt;     &lt;int&gt;
 1 2010/01     308
 2 2010/02     325
 3 2010/03     333
 4 2010/04     380
 5 2010/05     443
 6 2010/06     381
 7 2010/07     406
 8 2010/08     348
 9 2010/09     426
10 2010/10     417
# ℹ 149 more rows</code></pre>
</div>
</div>
</section><section id="junção-de-dados" class="level2"><h2 class="anchored" data-anchor-id="junção-de-dados">4.6 Junção de dados</h2>
<p>É raro que uma análise de dados envolva apenas uma única fonte de dados. Normalmente, você possui vários <code>data.frames</code> e precisa uni-los para realizar as análises que lhe interessam.</p>
<section id="dados" class="level3"><h3 class="anchored" data-anchor-id="dados">4.6.1 Dados</h3>
<p>Para a aula de hoje, utilizaremos o pacote <code>nycflights13</code>, o qual contém dados relacionados a voos na cidade de Nova York.</p>
</section><section id="chaves-primárias-e-chaves-estrangeiras" class="level3"><h3 class="anchored" data-anchor-id="chaves-primárias-e-chaves-estrangeiras">4.6.2 Chaves Primárias e Chaves Estrangeiras</h3>
<p>Para compreender os principais tipos de junções de banco de dados, é fundamental entender como duas tabelas podem ser conectadas por meio de um par de chaves, dentro de cada tabela. Vamos estudar brevemente sobre os dois tipos principais de chaves, para isso, vamos utilizar os conjuntos de dados do pacote <code>nycflights13</code>. Esse pacote apresenta cinco tabelas com informações distintas acerca de vôos em New York.</p>
<section id="chaves-primárias-e-estrangeiras" class="level4"><h4 class="anchored" data-anchor-id="chaves-primárias-e-estrangeiras">4.6.2.1 Chaves primárias e estrangeiras</h4>
<p>Toda junção envolve um par de chaves: <em>uma chave primária e uma chave estrangeira</em>. <strong>Uma chave primária é uma variável ou conjunto de variáveis que identifica cada observação de forma única</strong>. Quando mais de uma variável é necessária, a chave é chamada de chave composta. Por exemplo, no <code>nycfights13</code>:</p>
<ul>
<li>A tabela <code>airlines</code> registra dois dados sobre cada companhia aérea: seu código de operadora e seu nome completo. Você pode identificar uma companhia aérea pelo seu código de operadora de duas letras, tornando o código de operadora (<code>carrier</code>) a chave primária (<em>primary key</em>).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: nycflights13</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airlines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   carrier name                       
   &lt;chr&gt;   &lt;chr&gt;                      
 1 9E      Endeavor Air Inc.          
 2 AA      American Airlines Inc.     
 3 AS      Alaska Airlines Inc.       
 4 B6      JetBlue Airways            
 5 DL      Delta Air Lines Inc.       
 6 EV      ExpressJet Airlines Inc.   
 7 F9      Frontier Airlines Inc.     
 8 FL      AirTran Airways Corporation
 9 HA      Hawaiian Airlines Inc.     
10 MQ      Envoy Air                  
11 OO      SkyWest Airlines Inc.      
12 UA      United Air Lines Inc.      
13 US      US Airways Inc.            
14 VX      Virgin America             
15 WN      Southwest Airlines Co.     
16 YV      Mesa Airlines Inc.         </code></pre>
</div>
</div>
<ul>
<li>A tabela <code>airports</code>, por sua vez, registra dados sobre cada aeroporto. Podemos identificar cada aeroporto pelo seu código de aeroporto de três letras, tornando o código <code>FAA</code> a chave primária.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 8
   faa   name                             lat    lon   alt    tz dst   tzone    
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
 1 04G   Lansdowne Airport               41.1  -80.6  1044    -5 A     America/…
 2 06A   Moton Field Municipal Airport   32.5  -85.7   264    -6 A     America/…
 3 06C   Schaumburg Regional             42.0  -88.1   801    -6 A     America/…
 4 06N   Randall Airport                 41.4  -74.4   523    -5 A     America/…
 5 09J   Jekyll Island Airport           31.1  -81.4    11    -5 A     America/…
 6 0A9   Elizabethton Municipal Airport  36.4  -82.2  1593    -5 A     America/…
 7 0G6   Williams County Airport         41.5  -84.5   730    -5 A     America/…
 8 0G7   Finger Lakes Regional Airport   42.9  -76.8   492    -5 A     America/…
 9 0P2   Shoestring Aviation Airfield    39.8  -76.6  1000    -5 U     America/…
10 0S9   Jefferson County Intl           48.1 -123.    108    -8 A     America/…
# ℹ 1,448 more rows</code></pre>
</div>
</div>
<ul>
<li>A tabela <code>planes</code> registra dados sobre cada aeronave. Podemos identificar uma aeronave pelo seu número de cauda (<code>tailnum</code>), tornando o número de cauda a chave primária.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,322 × 9
   tailnum  year type              manufacturer model engines seats speed engine
   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
 1 N10156   2004 Fixed wing multi… EMBRAER      EMB-…       2    55    NA Turbo…
 2 N102UW   1998 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 3 N103US   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 4 N104UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 5 N10575   2002 Fixed wing multi… EMBRAER      EMB-…       2    55    NA Turbo…
 6 N105UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 7 N107US   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 8 N108UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 9 N109UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
10 N110UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
# ℹ 3,312 more rows</code></pre>
</div>
</div>
<ul>
<li>A tabela <code>weather</code> registra dados sobre o clima nos aeroportos de origem. Você pode identificar cada observação pela <strong>combinação</strong> de localização e horário, tornando a origem (<code>origin</code>) e o horário (<code>time_hour</code>) a <strong>chave primária composta</strong>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26,115 × 15
   origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
   &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 
 2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06
 3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 
 4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 
 5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 
 6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 
 7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 
 8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 
 9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 
10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 
# ℹ 26,105 more rows
# ℹ 5 more variables: wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
#   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p><strong>Uma chave estrangeira é uma variável (ou conjunto de variáveis) que corresponde a uma chave primária em outra tabela</strong>. Por exemplo:</p>
<ul>
<li>
<code>flights$tailnum</code> é uma chave estrangeira que corresponde à chave primária <code>planes$tailnum</code>.</li>
<li>
<code>flights$carrier</code> é uma chave estrangeira que corresponde à chave primária <code>airlines$carrier</code>.</li>
</ul>
<p>Podemos ver como cada banco de dados está relacionado com os demais na Figura abaixo. <img src="./imagens/ncyflights13.png" class="img-fluid" alt="Descrição da Imagem"></p>
<ul>
<li><p>A Tabela “flights” está vinculada à tabela “planes” por meio de uma variável única, “tailnum”.</p></li>
<li><p>A Tabela “flights” está vinculada à tabela “airlines” por meio de uma variável única, “carrier”.</p></li>
<li><p>A Tabela “flights” está vinculada à tabela “airports” de duas maneiras: por meio das variáveis “origin” e “dest”.</p></li>
<li><p>A Tabela “flights” está vinculada à tabela “weather” por meio das variáveis “origin” (localização), “year”, “month”, “day” e “hour”.</p></li>
</ul>
<p>Note que as chaves primárias e estrangeiras têm quase sempre os mesmos nomes, o que, como veremos em breve, tornará sua vida de junção muito mais fácil. Também vale a pena observar a relação oposta: quase todos os nomes de variáveis usados em várias tabelas têm o mesmo significado em cada lugar. Há apenas uma exceção: o ano (<code>year</code>) significa o ano de partida nos voos (<code>flights</code>) e o ano de fabricação nas aeronaves (<code>planes</code>).</p>
</section><section id="verificação-de-chaves-primárias" class="level4"><h4 class="anchored" data-anchor-id="verificação-de-chaves-primárias">4.6.2.2 Verificação de Chaves Primárias</h4>
<p>Agora que identificamos as chaves primárias em cada tabela, é uma boa prática verificar se elas realmente identificam de forma única cada observação. Uma maneira de fazer isso é contar as chaves primárias e procurar entradas em que <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> seja maior que um.</p>
<div class="cell">
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">time_hour</span>, <span class="va">origin</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: time_hour &lt;dttm&gt;, origin &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<p>Além de termos chave primária única, é importante que não haja valores faltantes, se um valor estiver ausente, ele não poderá identificar uma observação.</p>
<div class="cell">
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 9
# ℹ 9 variables: tailnum &lt;chr&gt;, year &lt;int&gt;, type &lt;chr&gt;, manufacturer &lt;chr&gt;,
#   model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">time_hour</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 15
# ℹ 15 variables: origin &lt;chr&gt;, year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, hour &lt;int&gt;,
#   temp &lt;dbl&gt;, dewp &lt;dbl&gt;, humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;,
#   wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section></section><section id="combinando-dados" class="level3"><h3 class="anchored" data-anchor-id="combinando-dados">4.6.3 Combinando dados</h3>
<p>Bom, agora que compreendemos a importância de chaves vamos agora introdur dois tipos importantes de junções:</p>
<ul>
<li>Junções mutacionais, que adicionam novas variáveis a um conjunto de dados a partir de observações correspondentes em outro banco de dados. São elas:
<ul>
<li>
<code>inner_join</code>;</li>
<li>
<code>full_join</code>;</li>
<li>
<code>left_join</code>;</li>
<li>
<code>right_join</code>.</li>
</ul>
</li>
<li>Junções de filtragem, que filtram observações de um quadro de dados com base em se elas correspondem ou não a uma observação em outro banco de dados.
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code>;</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>.</li>
</ul>
</li>
</ul></section><section id="junções-mutacionais" class="level3"><h3 class="anchored" data-anchor-id="junções-mutacionais">4.6.4 Junções Mutacionais</h3>
<p>Uma junção mutacional (<em>mutating join</em>) permite combinar <strong>variáveis de dois conjuntos de dados</strong>: primeiro, ele corresponde às observações através de suas chaves e, em seguida, copia as variáveis de um conjunto de dados para o outro. Assim como a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, as funções de <code>join</code> adicionam variáveis <em>à direita</em>, portanto, se o seu conjunto de dados tiver muitas variáveis, as novas variáveis não serão imediatamente visíveis. Para facilitar a compreensão dos exemplos a seguir, criaremos um conjunto de dados mais suscinto com apenas seis variáveis, e apenas com vôos com distância superior à 1000km:</p>
<div class="cell">
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distance</span> <span class="op">&gt;</span> <span class="fl">2000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">time_hour</span>, <span class="va">origin</span>, <span class="va">dest</span>, <span class="va">tailnum</span>, <span class="va">carrier</span><span class="op">)</span></span>
<span><span class="va">flights2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51,695 × 6
    year time_hour           origin dest  tailnum carrier
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1  2013 2013-01-01 06:00:00 JFK    LAX   N29129  UA     
 2  2013 2013-01-01 06:00:00 EWR    SFO   N53441  UA     
 3  2013 2013-01-01 06:00:00 EWR    LAS   N76515  UA     
 4  2013 2013-01-01 06:00:00 JFK    SFO   N532UA  UA     
 5  2013 2013-01-01 06:00:00 EWR    PHX   N807AW  US     
 6  2013 2013-01-01 06:00:00 JFK    PHX   N535UW  US     
 7  2013 2013-01-01 06:00:00 EWR    LAX   N33289  UA     
 8  2013 2013-01-01 06:00:00 EWR    SNA   N38727  UA     
 9  2013 2013-01-01 06:00:00 JFK    LAS   N558JB  B6     
10  2013 2013-01-01 07:00:00 JFK    SFO   N705TW  DL     
# ℹ 51,685 more rows</code></pre>
</div>
</div>
<section id="left-join" class="level4"><h4 class="anchored" data-anchor-id="left-join">4.6.4.1 Left Join</h4>
<p>O <code>left join</code> retorna todas as linhas do primeiro conjunto de dados (tabela à esquerda) e as linhas correspondentes do segundo conjunto de dados (tabela à direita), se houver correspondência. Se não houver correspondência na tabela à direita, os valores serão preenchidos com <code>NA</code> (valores ausentes).</p>
<p><img src="./imagens/leftjoin.svg" class="img-fluid" alt="Descrição da Imagem"> Suponha que gostariamos de adicionar o nome completo da companhia aerea no nosso banco de dados. Para isso, precisamos combinar as informações de <code>flights2</code> com <code>airlines</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2_airlines</span> <span class="op">=</span> </span>
<span>  <span class="va">flights2</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">airlines</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(carrier)`</code></pre>
</div>
</div>
<p>Note que, por definição, a função buscou a chave primária como <code>carrier</code>. Nesse caso, como temos apenas uma chave, é viável fazermos isso. Contudo, é uma boa prática definirmos qual a chave que gostaríamos de combinar os bancos de dados.</p>
<div class="cell">
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2_airlines</span> <span class="op">=</span> </span>
<span>  <span class="va">flights2</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">airlines</span>, </span>
<span>            by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights2_airlines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51,695 × 7
    year time_hour           origin dest  tailnum carrier name                 
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                
 1  2013 2013-01-01 06:00:00 JFK    LAX   N29129  UA      United Air Lines Inc.
 2  2013 2013-01-01 06:00:00 EWR    SFO   N53441  UA      United Air Lines Inc.
 3  2013 2013-01-01 06:00:00 EWR    LAS   N76515  UA      United Air Lines Inc.
 4  2013 2013-01-01 06:00:00 JFK    SFO   N532UA  UA      United Air Lines Inc.
 5  2013 2013-01-01 06:00:00 EWR    PHX   N807AW  US      US Airways Inc.      
 6  2013 2013-01-01 06:00:00 JFK    PHX   N535UW  US      US Airways Inc.      
 7  2013 2013-01-01 06:00:00 EWR    LAX   N33289  UA      United Air Lines Inc.
 8  2013 2013-01-01 06:00:00 EWR    SNA   N38727  UA      United Air Lines Inc.
 9  2013 2013-01-01 06:00:00 JFK    LAS   N558JB  B6      JetBlue Airways      
10  2013 2013-01-01 07:00:00 JFK    SFO   N705TW  DL      Delta Air Lines Inc. 
# ℹ 51,685 more rows</code></pre>
</div>
</div>
</section><section id="right-join" class="level4"><h4 class="anchored" data-anchor-id="right-join">4.6.4.2 Right Join</h4>
<p>O <code>right_join</code> retorna apenas as linhas do primeiro conjunto de dados (tabela à esquerda) se houver correspondência com o segundo conjunto de dados (tabela à direita). Se não houver correspondência na tabela à esquerda, os valores serão preenchidos com <code>NA</code> (valores ausentes).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/righttjoin.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
<p>Suponha que, temos interesse em buscar informações acerca dos dos vôos realizados pelos aviões em <code>flights2</code>. Para isso, basta unirmos as tabelas <code>planes</code> com <code>flights2</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes_flights</span> <span class="op">=</span> <span class="va">flights2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">planes</span>, by <span class="op">=</span> <span class="st">"tailnum"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">planes_flights</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50,720 × 14
   year.x time_hour           origin dest  tailnum carrier year.y type          
    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;         
 1   2013 2013-01-01 06:00:00 JFK    LAX   N29129  UA        1998 Fixed wing mu…
 2   2013 2013-01-01 06:00:00 EWR    SFO   N53441  UA          NA Fixed wing mu…
 3   2013 2013-01-01 06:00:00 EWR    LAS   N76515  UA        2008 Fixed wing mu…
 4   2013 2013-01-01 06:00:00 EWR    PHX   N807AW  US        1999 Fixed wing mu…
 5   2013 2013-01-01 06:00:00 JFK    PHX   N535UW  US        2009 Fixed wing mu…
 6   2013 2013-01-01 06:00:00 EWR    LAX   N33289  UA        2004 Fixed wing mu…
 7   2013 2013-01-01 06:00:00 EWR    SNA   N38727  UA        1999 Fixed wing mu…
 8   2013 2013-01-01 06:00:00 JFK    LAS   N558JB  B6        2003 Fixed wing mu…
 9   2013 2013-01-01 07:00:00 JFK    SFO   N705TW  DL        1997 Fixed wing mu…
10   2013 2013-01-01 07:00:00 JFK    LAX   N627VA  VX        2006 Fixed wing mu…
# ℹ 50,710 more rows
# ℹ 6 more variables: manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;,
#   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>
</section><section id="inner-join" class="level4"><h4 class="anchored" data-anchor-id="inner-join">4.6.4.3 Inner Join</h4>
<p>O <code>inner join</code> retorna apenas as linhas que têm correspondências em ambos os conjuntos de dados. Ou seja, ele preserva apenas as observações com chaves correspondentes em ambas as tabelas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/innerjoin.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
<p>Suponha que, temos interesse em buscar informações acerca dos aeroportos de origem realizados pelos aviões em <code>flights2</code>. Porém, apenas temos interesse em informações que aparecem em ambos bancos. Para isso, basta unirmos as tabelas <code>flights2</code> com <code>airports</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">origin_flights</span> <span class="op">=</span> <span class="va">flights2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"origin"</span><span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">origin_flights</span> <span class="op">=</span> <span class="va">flights2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">origin</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">origin_flights</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51,695 × 13
    year time_hour           origin dest  tailnum carrier name         lat   lon
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1  2013 2013-01-01 06:00:00 JFK    LAX   N29129  UA      John F Ke…  40.6 -73.8
 2  2013 2013-01-01 06:00:00 EWR    SFO   N53441  UA      Newark Li…  40.7 -74.2
 3  2013 2013-01-01 06:00:00 EWR    LAS   N76515  UA      Newark Li…  40.7 -74.2
 4  2013 2013-01-01 06:00:00 JFK    SFO   N532UA  UA      John F Ke…  40.6 -73.8
 5  2013 2013-01-01 06:00:00 EWR    PHX   N807AW  US      Newark Li…  40.7 -74.2
 6  2013 2013-01-01 06:00:00 JFK    PHX   N535UW  US      John F Ke…  40.6 -73.8
 7  2013 2013-01-01 06:00:00 EWR    LAX   N33289  UA      Newark Li…  40.7 -74.2
 8  2013 2013-01-01 06:00:00 EWR    SNA   N38727  UA      Newark Li…  40.7 -74.2
 9  2013 2013-01-01 06:00:00 JFK    LAS   N558JB  B6      John F Ke…  40.6 -73.8
10  2013 2013-01-01 07:00:00 JFK    SFO   N705TW  DL      John F Ke…  40.6 -73.8
# ℹ 51,685 more rows
# ℹ 4 more variables: alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
</div>
</section><section id="full-join" class="level4"><h4 class="anchored" data-anchor-id="full-join">4.6.4.4 Full Join</h4>
<p>O <code>full_join</code> retorna todas as linhas de ambos os conjuntos de dados (tabelas à esquerda e à direita). Ele preenche com <code>NA</code> aqueles valores que não têm correspondência em uma das tabelas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/fulljoin.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
<p>Suponha que, temos interesse em buscar informações acerca dos aeroportos de destino realizados pelos aviões em <code>flights2</code>. Porém, apenas temos interesse em todas informações que aparecem em ambos bancos. Para isso, basta unirmos as tabelas <code>flights2</code> com <code>airports</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dest_flights</span> <span class="op">=</span> <span class="va">flights2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span><span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dest_flights</span> <span class="op">=</span> <span class="va">flights2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">dest</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dest_flights</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,137 × 13
    year time_hour           origin dest  tailnum carrier name         lat   lon
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1  2013 2013-01-01 06:00:00 JFK    LAX   N29129  UA      Los Angel…  33.9 -118.
 2  2013 2013-01-01 06:00:00 EWR    SFO   N53441  UA      San Franc…  37.6 -122.
 3  2013 2013-01-01 06:00:00 EWR    LAS   N76515  UA      Mc Carran…  36.1 -115.
 4  2013 2013-01-01 06:00:00 JFK    SFO   N532UA  UA      San Franc…  37.6 -122.
 5  2013 2013-01-01 06:00:00 EWR    PHX   N807AW  US      Phoenix S…  33.4 -112.
 6  2013 2013-01-01 06:00:00 JFK    PHX   N535UW  US      Phoenix S…  33.4 -112.
 7  2013 2013-01-01 06:00:00 EWR    LAX   N33289  UA      Los Angel…  33.9 -118.
 8  2013 2013-01-01 06:00:00 EWR    SNA   N38727  UA      John Wayn…  33.7 -118.
 9  2013 2013-01-01 06:00:00 JFK    LAS   N558JB  B6      Mc Carran…  36.1 -115.
10  2013 2013-01-01 07:00:00 JFK    SFO   N705TW  DL      San Franc…  37.6 -122.
# ℹ 53,127 more rows
# ℹ 4 more variables: alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
</div>
</section></section><section id="junções-de-filtragem" class="level3"><h3 class="anchored" data-anchor-id="junções-de-filtragem">4.6.5 Junções de Filtragem</h3>
<p>Como o próprio nome sugere, a ação principal de uma junção de filtragem é filtrar as linhas. Existem dois tipos: semi-junções e anti-junções. Semi-junções mantêm todas as linhas em <code>x</code> que têm uma correspondência em <code>y</code>. Por exemplo, poderíamos usar uma semi-junção para filtrar o conjunto de dados de aeroportos (<code>airports</code>) para mostrar apenas os aeroportos de origem:</p>
<div class="cell">
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">flights2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">faa</span> <span class="op">==</span> <span class="va">origin</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  faa   name                  lat   lon   alt    tz dst   tzone           
  &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
1 EWR   Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
2 JFK   John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York</code></pre>
</div>
</div>
<p>Anti-junções são o oposto: elas retornam todas as linhas em <code>x</code> que não têm correspondência em <code>y</code>. São úteis para encontrar valores ausentes que são implícitos nos dados. Valores implicitamente ausentes não aparecem como NAs, mas sim existem apenas como uma ausência. Por exemplo, podemos encontrar linhas ausentes em aeroportos procurando voos que não tenham um aeroporto de destino correspondente:</p>
<div class="cell">
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">dest</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 1
  dest 
  &lt;chr&gt;
1 BQN  
2 SJU  
3 STT  
4 PSE  </code></pre>
</div>
</div>
</section></section><section id="exercícios-1" class="level2"><h2 class="anchored" data-anchor-id="exercícios-1">4.7 Exercícios</h2>
<div class="cell">
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="va">flights_voos</span> <span class="op">&lt;-</span> <span class="va">flights</span></span>
<span><span class="va">flights_cias</span> <span class="op">&lt;-</span> <span class="va">airlines</span></span>
<span><span class="va">flights_aeroportos</span> <span class="op">&lt;-</span> <span class="va">airports</span></span>
<span><span class="va">flights_aviao</span> <span class="op">&lt;-</span> <span class="va">planes</span></span>
<span><span class="va">flights_clima</span> <span class="op">&lt;-</span> <span class="va">weather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Para vôos com atraso superior a 24 horas em <code>flights</code>, verifique as condições climáticas em <code>weather</code>. Há algum padrão? Quais os meses do ano em que você encontra os maiores atrasos?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filtrar os voos com atraso superior a 24 horas em "flights"</span></span>
<span><span class="va">voos_atraso_24h</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Juntar os dados de clima de "weather" com os voos atrasados</span></span>
<span><span class="va">voos_clima_atraso</span> <span class="op">&lt;-</span> <span class="va">voos_atraso_24h</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">weather</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., weather, by = c("year", "month", "day")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Agregar e calcular a contagem de voos atrasados por mês</span></span>
<span><span class="va">contagem_atrasos_por_mes</span> <span class="op">&lt;-</span> <span class="va">voos_clima_atraso</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_atrasos <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exibir os meses com os maiores atrasos</span></span>
<span><span class="va">meses_maior_atraso</span> <span class="op">&lt;-</span> <span class="va">contagem_atrasos_por_mes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">total_atrasos</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exibir a tabela de frequência dos meses com os maiores atrasos</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">meses_maior_atraso</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  month total_atrasos
  &lt;int&gt;         &lt;int&gt;
1     7        684804
2    12        676632
3     6        642168
4     4        605641
5     8        538609
6     3        506040</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Encontre os 20 destinos mais comuns e identifique seu aeroporto. Qual a temperatura média (mensal) em Celcius desses lugares? E a precipitação média, em cm?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convertendo temperatura de °F para °C e polegadas para cm</span></span>
<span><span class="va">flights_clima</span> <span class="op">&lt;-</span> <span class="va">flights_clima</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>temp_celsius <span class="op">=</span> <span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1.8</span>,</span>
<span>         precip_cm <span class="op">=</span> <span class="va">precip</span> <span class="op">*</span> <span class="fl">2.54</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flitrando flight voos e identificando seu aeroporto</span></span>
<span><span class="va">flights_destinos</span> <span class="op">&lt;-</span> <span class="va">flights_voos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span><span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dest</span>, <span class="va">origin</span>, <span class="va">name</span>, <span class="va">time_hour</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Encontrando os 20 maiores destino, e media de temperatura e precipitação</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="va">flights_destinos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flights_clima</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dest</span>, <span class="va">origin</span>, <span class="va">name</span>, <span class="va">time_hour</span>, <span class="va">temp_celsius</span>, <span class="va">precip_cm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dest</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>media_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">temp_celsius</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            media_precip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">precip_cm</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(origin, time_hour)`
`summarise()` has grouped output by 'dest'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Exibindo o resultado</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">q2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
# Groups:   dest [20]
   dest  name                               media_temp media_precip
   &lt;chr&gt; &lt;chr&gt;                                   &lt;dbl&gt;        &lt;dbl&gt;
 1 ABQ   Albuquerque International Sunport        16.0      0.0136 
 2 ACK   Nantucket Mem                            23.5      0.0116 
 3 ALB   Albany Intl                              10.1      0.00629
 4 ANC   Ted Stevens Anchorage Intl               28.7      0      
 5 ATL   Hartsfield Jackson Atlanta Intl          14.0      0.0123 
 6 AUS   Austin Bergstrom Intl                    13.9      0.0138 
 7 AVL   Asheville Regional Airport               18.9      0.0154 
 8 BDL   Bradley Intl                             12.8      0.0125 
 9 BGR   Bangor Intl                              16.4      0.00563
10 BHM   Birmingham Intl                          15.3      0.0208 
11 BNA   Nashville Intl                           14.8      0.0119 
12 BOS   General Edward Lawrence Logan Intl       14.0      0.0124 
13 BTV   Burlington Intl                          14.0      0.0123 
14 BUF   Buffalo Niagara Intl                     13.2      0.00970
15 BUR   Bob Hope                                 13.4      0.00688
16 BWI   Baltimore Washington Intl                11.2      0.00990
17 BZN   Gallatin Field                           14.3      0      
18 CAE   Columbia Metropolitan                    13.8      0.0100 
19 CAK   Akron Canton Regional Airport            15.2      0.0132 
20 CHO   Charlottesville-Albemarle                11.2      0.00684</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Inclua uma coluna com a cia aérea na tabela <code>planes</code>. Quantas companhias áreas voaram cada avião naquele ano?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filtrando voos de cada companhia aerea</span></span>
<span><span class="va">flights_by_cia</span> <span class="op">&lt;-</span> <span class="va">flights_cias</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">flights_voos</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">tailnum</span>, <span class="va">carrier</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_voos <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'tailnum', 'carrier'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Verificando se a filtragem está correta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">flights_by_cia</span><span class="op">$</span><span class="va">total_voos</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776</code></pre>
</div>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">flights_voos</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776</code></pre>
</div>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Juntando as informações das companhias aéreas com os aviões</span></span>
<span><span class="va">planes_with_airlines</span> <span class="op">&lt;-</span> <span class="va">flights_aviao</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_by_cia</span>, </span>
<span>            by <span class="op">=</span> <span class="st">"tailnum"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exibindo o resultado</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">planes_with_airlines</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,339 × 12
   tailnum  year type      manufacturer model engines seats speed engine carrier
   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  
 1 N10156   2004 Fixed wi… EMBRAER      EMB-…       2    55    NA Turbo… EV     
 2 N102UW   1998 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 3 N103US   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 4 N104UW   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 5 N10575   2002 Fixed wi… EMBRAER      EMB-…       2    55    NA Turbo… EV     
 6 N105UW   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 7 N107US   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 8 N108UW   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
 9 N109UW   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
10 N110UW   1999 Fixed wi… AIRBUS INDU… A320…       2   182    NA Turbo… US     
# ℹ 3,329 more rows
# ℹ 2 more variables: name &lt;chr&gt;, total_voos &lt;int&gt;</code></pre>
</div>
</div>
<p>Inclua a latitude e longitude de cada origem destino na tabela <code>flights</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filtrando flights_aeroportos</span></span>
<span><span class="va">flights_lat_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flights_aeroportos</span>, <span class="va">faa</span>, <span class="va">lat</span>, <span class="va">lon</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Agora, vamos juntar as informações de latitude e longitude com a tabela "flights"</span></span>
<span><span class="va">flights_coordinates</span> <span class="op">&lt;-</span> <span class="va">flights_voos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_lat_long</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"origin"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>origin_lat <span class="op">=</span> <span class="va">lat</span>, origin_lon <span class="op">=</span> <span class="va">lon</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_lat_long</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>dest_lat <span class="op">=</span> <span class="va">lat</span>, dest_lon <span class="op">=</span> <span class="va">lon</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exibir o resultado</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">flights_coordinates</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 6
   origin dest  origin_lat origin_lon dest_lat dest_lon
   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 EWR    IAH         40.7      -74.2     30.0    -95.3
 2 LGA    IAH         40.8      -73.9     30.0    -95.3
 3 JFK    MIA         40.6      -73.8     25.8    -80.3
 4 JFK    BQN         40.6      -73.8     NA       NA  
 5 LGA    ATL         40.8      -73.9     33.6    -84.4
 6 EWR    ORD         40.7      -74.2     42.0    -87.9
 7 EWR    FLL         40.7      -74.2     26.1    -80.2
 8 LGA    IAD         40.8      -73.9     38.9    -77.5
 9 JFK    MCO         40.6      -73.8     28.4    -81.3
10 LGA    ORD         40.8      -73.9     42.0    -87.9
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section><section id="organização-de-dados" class="level2"><h2 class="anchored" data-anchor-id="organização-de-dados">4.8 Organização de dados</h2>
<p>Compreender a organização de dados é fundamental para análises estatísticas eficazes. Quando trabalhamos com dados em R, é importante seguir as regras que tornam um conjunto de dados <em>tidy</em> (organizado), o que facilita o processamento e a interpretação dos dados. Existem três regras inter-relacionadas que tornam um conjunto de dados <em>tidy</em>:</p>
<ol type="1">
<li>
<strong>Cada variável é uma coluna; cada coluna é uma variável</strong>: Isso significa que cada característica ou medida que você está analisando deve ser representada por uma coluna separada no conjunto de dados.</li>
</ol>
<ul>
<li>Por exemplo, se você estiver trabalhando com dados de pacientes, as variáveis como idade, gênero, altura e peso devem ser colunas separadas.</li>
</ul>
<ol start="2" type="1">
<li>
<strong>Cada observação é uma linha; cada linha é uma observação</strong>: Cada linha do conjunto de dados deve representar uma única observação, caso ou instância. Isso garante que os dados estejam organizados de maneira que seja fácil identificar e comparar diferentes casos.</li>
</ol>
<ul>
<li>Por exemplo, cada linha pode representar um paciente individual em um conjunto de dados médicos.</li>
</ul>
<ol start="3" type="1">
<li>
<strong>Cada valor é uma célula; cada célula é um único valor</strong>: Cada célula no conjunto de dados deve conter um único valor. Isso significa que não deve haver combinações de valores em uma única célula. Cada célula deve conter uma informação única e específica relacionada à variável e à observação correspondente.</li>
</ol>
<p>Ao seguir essas três regras, você cria um conjunto de dados tidy que é fácil de manipular, visualizar e analisar. Essa organização facilita a utilização de funções como <code>pivot_longer</code> e <code>pivot_wider</code> para remodelar os dados quando necessário a fim de adaptá-los às necessidades de sua análise estatística em R</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/tidy_data.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
<section id="pivotagem" class="level3"><h3 class="anchored" data-anchor-id="pivotagem">4.8.1 Pivotagem</h3>
<p>Pivotar, como o próprio nome sugere, é um processo de transformação de um conjunto de dados, no qual as colunas e linhas são reorganizadas de tal forma que os valores que originalmente estavam dispostos em linhas agora são apresentados como colunas, e vice-versa. Esse procedimento é fundamental para preparar e organizar dados para análises estatísticas e visualizações mais eficazes.</p>
<section id="formato-wide-largo-e-formato-long-longo" class="level4"><h4 class="anchored" data-anchor-id="formato-wide-largo-e-formato-long-longo">4.8.1.1 Formato Wide (Largo) e Formato Long (Longo)</h4>
<p>Em ciência de dados, é comum falarmos em dois formatos principais: o formato <em>wide</em> (largo) e o formato <em>long</em> (longo). Essas representações são especialmente úteis para diferentes tipos de análises e visualizações.</p>
<ol type="1">
<li>
<strong>Formato Wide (Largo)</strong>: Nesse formato, os dados são organizados de forma que cada variável é representada por uma coluna separada e cada observação (ou instância) ocupa uma única linha. Isso significa que as informações são distribuídas em várias colunas, tornando-o mais adequado para conjuntos de dados com poucas variáveis, onde as informações são bem condensadas.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/tidy_data.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
<ol start="2" type="1">
<li>
<strong>Formato Long (Longo)</strong>: Já no formato long (ou longo), os dados são organizados de maneira que as variáveis estão empilhadas em uma única coluna, enquanto uma coluna adicional é usada para indicar o nome da variável. Cada observação é representada por uma linha separada. Esse formato é ideal quando se trabalha com conjuntos de dados mais complexos, nos quais as informações estão espalhadas em várias categorias ou momentos de tempo, por exemplo.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./imagens/long_data.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Descrição da Imagem</figcaption></figure>
</div>
</section></section><section id="exercício-1" class="level3"><h3 class="anchored" data-anchor-id="exercício-1">4.8.2 Exercício</h3>
<p>Com os dois conjuntos de dados abaixo, defina qual a versão <em>organizada</em> dos dados.</p>
<ol type="1">
<li><strong>Conjunto 1:</strong></li>
</ol>
<ul>
<li>
<strong>Wide</strong>:</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>Nome</th>
<th>Idade</th>
<th>Peso (kg)</th>
<th>Gênero</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Alice</td>
<td>34</td>
<td>52.16</td>
<td>Feminino</td>
</tr>
<tr class="even">
<td>Bob</td>
<td>35</td>
<td>72.57</td>
<td>Masculino</td>
</tr>
<tr class="odd">
<td>Christine</td>
<td>38</td>
<td>56.70</td>
<td>Feminino</td>
</tr>
</tbody>
</table>
<ul>
<li>
<strong>Long</strong>:</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>Nome</th>
<th>Variável</th>
<th>Valor</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Alice</td>
<td>Idade</td>
<td>34</td>
</tr>
<tr class="even">
<td>Alice</td>
<td>Peso (kg)</td>
<td>52.16</td>
</tr>
<tr class="odd">
<td>Alice</td>
<td>Gênero</td>
<td>Feminino</td>
</tr>
<tr class="even">
<td>Bob</td>
<td>Idade</td>
<td>35</td>
</tr>
<tr class="odd">
<td>Bob</td>
<td>Peso (kg)</td>
<td>72.57</td>
</tr>
<tr class="even">
<td>Bob</td>
<td>Gênero</td>
<td>Masculino</td>
</tr>
<tr class="odd">
<td>Christine</td>
<td>Idade</td>
<td>38</td>
</tr>
<tr class="even">
<td>Christine</td>
<td>Peso (kg)</td>
<td>56.70</td>
</tr>
<tr class="odd">
<td>Christine</td>
<td>Gênero</td>
<td>Feminino</td>
</tr>
</tbody>
</table>
<ol type="1">
<li><strong>Conjunto 2:</strong></li>
</ol>
<ul>
<li>
<strong>Wide</strong>:</li>
</ul>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 18%">
</colgroup>
<thead><tr class="header">
<th>Tamanho da Pedra</th>
<th>Tratamento A - Recuperados</th>
<th>Tratamento A - Falhas</th>
<th>Tratamento B - Recuperados</th>
<th>Tratamento B - Falhas</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Pequeno</td>
<td>81</td>
<td>6</td>
<td>234</td>
<td>36</td>
</tr>
<tr class="even">
<td>Grande</td>
<td>192</td>
<td>71</td>
<td>55</td>
<td>25</td>
</tr>
</tbody>
</table>
<ul>
<li>
<strong>Long</strong>:</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>Tamanho da Pedra</th>
<th>Tratamento</th>
<th>Recuperado</th>
<th>Falha</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Pequena</td>
<td>A</td>
<td>81</td>
<td>6</td>
</tr>
<tr class="even">
<td>Pequena</td>
<td>B</td>
<td>234</td>
<td>36</td>
</tr>
<tr class="odd">
<td>Grande</td>
<td>A</td>
<td>192</td>
<td>71</td>
</tr>
<tr class="even">
<td>Grande</td>
<td>B</td>
<td>55</td>
<td>25</td>
</tr>
</tbody>
</table></section><section id="pivotando-dados-em-r" class="level3"><h3 class="anchored" data-anchor-id="pivotando-dados-em-r">4.8.2 Pivotando dados em R</h3>
<p>Para aprendermos sobre os tipos de <em>pivot</em> em R, vamos utilizar o banco de dados <code>table1</code>. Esse banco de dados possui dados de casos reportados de Tuberculose e o tamanho da população em dois anos para três países. Esses dados são provenientes dos dados <code>who</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">table1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  country      year  cases population
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 Afghanistan  1999    745   19987071
2 Afghanistan  2000   2666   20595360
3 Brazil       1999  37737  172006362
4 Brazil       2000  80488  174504898
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
</div>
<section id="pivot_wider" class="level4"><h4 class="anchored" data-anchor-id="pivot_wider">4.8.2.1 <code>pivot_wider</code>
</h4>
<p>A função <code>pivot_wider</code> é usada para transformar um conjunto de dados de um formato longo para um formato largo. Isso é útil quando temos informações em uma única coluna que desejamos espalhar em várias colunas.</p>
<ul>
<li><strong>Sintaxe:</strong></li>
</ul>
<p><code>pivot_wider(data, names_from, values_from)</code> - <code>data</code>: O conjunto de dados que você deseja transformar. - <code>names_from</code>: A coluna que contém os nomes das variáveis que você deseja espalhar. - <code>values_from</code>: A coluna que contém os valores correspondentes a essas variáveis.</p>
<p><strong>Exemplo</strong>: Transformando em dados de <code>table1</code> em wide.</p>
<ul>
<li>Suponha que queremos o número de casos por ano.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">table1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">cases</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">cases</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  country     `1999` `2000`
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
1 Afghanistan    745   2666
2 Brazil       37737  80488
3 China       212258 213766</code></pre>
</div>
</div>
</section><section id="pivot_longer" class="level4"><h4 class="anchored" data-anchor-id="pivot_longer">4.8.2.2 <code>pivot_longer</code>
</h4>
<p>A função pivot_longer é utilizada para transformar um conjunto de dados de um formato largo (wide) para um formato longo (long). Isso é útil quando temos variáveis espalhadas em várias colunas e desejamos organizar esses dados em uma única coluna, tornando-os mais adequados para análises e visualizações. Geralmente, usamos <code>pivot_longer</code> quando temos variáveis empilhadas em diferentes colunas e queremos reunir essas informações em uma única coluna.</p>
<ul>
<li>
<strong>Sintaxe:</strong> <code>pivot_longer(data, cols, names_to, values_to)</code>
<ul>
<li>
<code>data</code>: O conjunto de dados que você deseja transformar.</li>
<li>
<code>cols</code>: As colunas que você deseja empilhar no formato longo.</li>
<li>
<code>names_to</code>: O nome da nova coluna que irá conter os nomes das variáveis empilhadas.</li>
<li>
<code>values_to</code>: O nome da nova coluna que irá conter os valores das variáveis empilhadas.</li>
</ul>
</li>
</ul>
<p><strong>Exemplo</strong>: Transformando em dados de <code>table1</code> em long.</p>
<ul>
<li>Suponha que queremos os casos e o tamanho da população como uma variável.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">table1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"variavel"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"tamanho"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   country      year variavel      tamanho
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1999 cases             745
 2 Afghanistan  1999 population   19987071
 3 Afghanistan  2000 cases            2666
 4 Afghanistan  2000 population   20595360
 5 Brazil       1999 cases           37737
 6 Brazil       1999 population  172006362
 7 Brazil       2000 cases           80488
 8 Brazil       2000 population  174504898
 9 China        1999 cases          212258
10 China        1999 population 1272915272
11 China        2000 cases          213766
12 China        2000 population 1280428583</code></pre>
</div>
</div>
</section><section id="separando-observações" class="level4"><h4 class="anchored" data-anchor-id="separando-observações">4.8.2.3 Separando observações</h4>
<p>A função separate() divide uma única coluna em várias colunas, dividindo-a sempre que um caractere separador aparece. Vamos considerar o exemplo da <code>table3</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">table3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
<p>Note que a coluna <code>rate</code> é na verdade uma coluna onde temos os casos e a população separadas por “/”. Podemos separar essa coluna em duas utilizando a função separate.</p>
<div class="cell">
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">separated</span> <span class="op">=</span> <span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Caso tenhamos interesse em uni-las novamente, podemos utilizar a função <code>unite</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">separated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">rate</span>, <span class="va">cases</span>, <span class="va">population</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
</section></section><section id="exemplo" class="level3"><h3 class="anchored" data-anchor-id="exemplo">4.8.3 Exemplo</h3>
<p>Vamos utilizar os dados de notificações de casos provenientes do site do <a href="https://www.who.int/teams/global-tuberculosis-programme/data">WHO</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./datasets/TB.csv.gz"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este conjunto de dados exemplifica uma situação comum na vida real, onde os dados estão desorganizados e não estão em um formato adequado para análises. Ele apresenta colunas redundantes, códigos de variáveis incomuns e uma abundância de valores ausentes. Em suma, está em uma condição “bagunçada” e precisaremos de várias etapas para limpá-lo e organizá-lo de forma apropriada. Assim como o pacote <code>dplyr</code>, o <code>tidyr</code> foi projetado para que cada função tenha uma função específica e bem definida. Isso significa que, em cenários da vida real, você geralmente precisará encadear várias dessas funções em uma sequência lógica para obter os dados em um estado utilizável.</p>
<p>O ponto de partida mais eficaz geralmente é reunir as colunas que não são consideradas variáveis. Vamos examinar o que temos:</p>
<ol type="1">
<li><p><strong>Country (país), iso2 e iso3</strong>: Essas três colunas parecem redundantes e especificam o país de formas diferentes. Variável redundante.</p></li>
<li><p><strong>Year (ano)</strong>: É claramente uma variável que representa o ano em que os dados foram registrados.</p></li>
<li><p><strong>Outras Colunas Não Identificadas</strong>: As colunas restantes, como “new_sp_m014”, “new_ep_m014” e “new_ep_f014”, não sabemos o que representam ainda. De acordo com a estrutura dos nomes das colunas, elas provavelmente contêm valores, não são variáveis.</p></li>
</ol>
<p>Portanto, nossa primeira tarefa é agrupar todas as colunas, desde “new_sp_m014” até “newrel_f65”, porque ainda não compreendemos completamente o que essas colunas representam. Chamaremos essa variável genérica de “chave”. Além disso, sabemos que as células dessas colunas representam a contagem de casos, então criaremos uma variável chamada “casos” para armazenar esses valores.</p>
<p>É importante observar que há muitos valores ausentes nos dados atuais. Para facilitar a análise inicial, usaremos a função “values_drop_na” para nos concentrarmos apenas nos valores que estão presentes, deixando os valores ausentes de lado temporariamente.</p>
<p>Dessa forma, estaremos prontos para começar o processo de organização e limpeza desses dados desorganizados.</p>
<div class="cell">
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB1</span> <span class="op">&lt;-</span> <span class="va">TB</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"chave"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"casos"</span>, </span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">TB1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 97,867 × 6
   country     iso2  iso3   year chave        casos
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;
 1 Afghanistan AF    AFG    1997 new_sp_m014      0
 2 Afghanistan AF    AFG    1997 new_sp_m1524    10
 3 Afghanistan AF    AFG    1997 new_sp_m2534     6
 4 Afghanistan AF    AFG    1997 new_sp_m3544     3
 5 Afghanistan AF    AFG    1997 new_sp_m4554     5
 6 Afghanistan AF    AFG    1997 new_sp_m5564     2
 7 Afghanistan AF    AFG    1997 new_sp_m65       0
 8 Afghanistan AF    AFG    1997 new_sp_f014      5
 9 Afghanistan AF    AFG    1997 new_sp_f1524    38
10 Afghanistan AF    AFG    1997 new_sp_f2534    36
# ℹ 97,857 more rows</code></pre>
</div>
</div>
<p>Para tentarmos entender a estrutura de chave, vamos contar ela.</p>
<div class="cell">
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">chave</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 2
   chave            n
   &lt;chr&gt;        &lt;int&gt;
 1 new_ep_f014   1029
 2 new_ep_f1524  1018
 3 new_ep_f2534  1018
 4 new_ep_f3544  1018
 5 new_ep_f4554  1014
 6 new_ep_f5564  1014
 7 new_ep_f65    1011
 8 new_ep_m014   1035
 9 new_ep_m1524  1023
10 new_ep_m2534  1017
# ℹ 46 more rows</code></pre>
</div>
</div>
<p>Se olharmos o dicionário de variáveis, presente junto aos dados, estamos interessados nos casos, ou seja, nas variáveis descritas por <code>new</code>. Vamos então, filtrar nossos dados para manter apenas essas variáveis.</p>
<div class="cell">
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">chave</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/like.html">%like%</a></span> <span class="st">"^new"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Além disso, o dicionário das variáveis nos informa o seguinte:</p>
<ul>
<li><p>As três primeiras letras de cada coluna indicam se a coluna contém casos novos (new) ou antigos (old) de tuberculose.</p></li>
<li>
<p>As letras seguintes descrevem o tipo de tuberculose:</p>
<ul>
<li><p>“rel” indica casos de recaída.</p></li>
<li><p>“ep” indica casos de tuberculose extrapulmonar.</p></li>
<li><p>“sn” indica casos de tuberculose pulmonar que não puderam ser diagnosticados por esfregaço pulmonar (<em>smear negative</em>).</p></li>
<li><p>“sp” indica casos de tuberculose pulmonar que puderam ser diagnosticados por esfregaço pulmonar (<em>smear positive</em>).</p></li>
</ul>
</li>
<li><p>A sexta letra indica o sexo dos pacientes com tuberculose, sendo “m” para masculino e “f” para feminino.</p></li>
<li>
<p>Os números restantes representam os grupos etários. O conjunto de dados agrupa os casos em sete faixas etárias:</p>
<ul>
<li><p>“014” = 0 a 14 anos</p></li>
<li><p>“1524” = 15 a 24 anos</p></li>
<li><p>“2534” = 25 a 34 anos</p></li>
<li><p>“3544” = 35 a 44 anos</p></li>
<li><p>“4554” = 45 a 54 anos</p></li>
<li><p>“5564” = 55 a 64 anos</p></li>
<li><p>“65” = 65 anos ou mais</p></li>
</ul>
</li>
</ul>
<p>Para tornar o formato dos nomes das colunas mais consistente, é necessário fazer um pequeno ajuste: infelizmente, os nomes estão ligeiramente inconsistentes, pois em vez de “new_rel”, temos “newrel”. Para isso, vamos utilizar a função <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code>, a ideia básica é simples: substituir os caracteres “newrel” por “new_rel”. Isso tornará todos os nomes das variáveis consistentes.</p>
<div class="cell">
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB2</span> <span class="op">&lt;-</span> <span class="va">TB1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>chave <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">chave</span>, <span class="st">"newrel"</span>, <span class="st">"new_rel"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">TB2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 97,867 × 6
   country     iso2  iso3   year chave        casos
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;
 1 Afghanistan AF    AFG    1997 new_sp_m014      0
 2 Afghanistan AF    AFG    1997 new_sp_m1524    10
 3 Afghanistan AF    AFG    1997 new_sp_m2534     6
 4 Afghanistan AF    AFG    1997 new_sp_m3544     3
 5 Afghanistan AF    AFG    1997 new_sp_m4554     5
 6 Afghanistan AF    AFG    1997 new_sp_m5564     2
 7 Afghanistan AF    AFG    1997 new_sp_m65       0
 8 Afghanistan AF    AFG    1997 new_sp_f014      5
 9 Afghanistan AF    AFG    1997 new_sp_f1524    38
10 Afghanistan AF    AFG    1997 new_sp_f2534    36
# ℹ 97,857 more rows</code></pre>
</div>
</div>
<p>Podemos separar os valores em cada código usando duas etapas da função <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. A primeira etapa dividirá os códigos em cada sublinhado (underscore).</p>
<div class="cell">
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB3</span> <span class="op">&lt;-</span> <span class="va">TB2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">chave</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"new"</span>, <span class="st">"type"</span>, <span class="st">"sexage"</span><span class="op">)</span>, </span>
<span>           sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">TB3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 97,867 × 8
   country     iso2  iso3   year new   type  sexage casos
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;
 1 Afghanistan AF    AFG    1997 new   sp    m014       0
 2 Afghanistan AF    AFG    1997 new   sp    m1524     10
 3 Afghanistan AF    AFG    1997 new   sp    m2534      6
 4 Afghanistan AF    AFG    1997 new   sp    m3544      3
 5 Afghanistan AF    AFG    1997 new   sp    m4554      5
 6 Afghanistan AF    AFG    1997 new   sp    m5564      2
 7 Afghanistan AF    AFG    1997 new   sp    m65        0
 8 Afghanistan AF    AFG    1997 new   sp    f014       5
 9 Afghanistan AF    AFG    1997 new   sp    f1524     38
10 Afghanistan AF    AFG    1997 new   sp    f2534     36
# ℹ 97,857 more rows</code></pre>
</div>
</div>
<p>Nesse caso, podemos eliminar a nova coluna, já que ela é constante em todo o conjunto de dados. Além disso, como mencionado anteriormente, as colunas “iso2” e “iso3” são redundantes e podem ser removidas. A eliminação de colunas não essenciais ajuda a simplificar o conjunto de dados e a economizar espaço de armazenamento.</p>
<div class="cell">
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB4</span> <span class="op">&lt;-</span> <span class="va">TB3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">new</span>, <span class="op">-</span><span class="va">iso2</span>, <span class="op">-</span><span class="va">iso3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora podemos separar o sexo e a idade.</p>
<div class="cell">
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB5</span> <span class="op">&lt;-</span> <span class="va">TB4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">sexage</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sexo"</span>, <span class="st">"idade"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">TB5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 97,867 × 6
   country      year type  sexo  idade casos
   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1 Afghanistan  1997 sp    m     014       0
 2 Afghanistan  1997 sp    m     1524     10
 3 Afghanistan  1997 sp    m     2534      6
 4 Afghanistan  1997 sp    m     3544      3
 5 Afghanistan  1997 sp    m     4554      5
 6 Afghanistan  1997 sp    m     5564      2
 7 Afghanistan  1997 sp    m     65        0
 8 Afghanistan  1997 sp    f     014       5
 9 Afghanistan  1997 sp    f     1524     38
10 Afghanistan  1997 sp    f     2534     36
# ℹ 97,857 more rows</code></pre>
</div>
</div>
</section><section id="exercícios-2" class="level3"><h3 class="anchored" data-anchor-id="exercícios-2">4.8.4 Exercícios</h3>
<ol type="1">
<li>Utilizando os dados de TB5, crie uma tabela em formato wide, com a quantidade de casos por país por ano. Cada ano deve ser chamado “Ano_.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TB6</span> <span class="op">&lt;-</span> <span class="va">TB5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">casos</span>,</span>
<span>              names_prefix <span class="op">=</span> <span class="st">"Ano_"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TB6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,338 × 46
   country     type  sexo  idade Ano_1997 Ano_1998 Ano_1999 Ano_2000 Ano_2001
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
 1 Afghanistan sp    m     014          0       30        8       52      129
 2 Afghanistan sp    m     1524        10      129       55      228      379
 3 Afghanistan sp    m     2534         6      128       55      183      349
 4 Afghanistan sp    m     3544         3       90       47      149      274
 5 Afghanistan sp    m     4554         5       89       34      129      204
 6 Afghanistan sp    m     5564         2       64       21       94      139
 7 Afghanistan sp    m     65           0       41        8       80      103
 8 Afghanistan sp    f     014          5       45       25       93      146
 9 Afghanistan sp    f     1524        38      350      139      414      799
10 Afghanistan sp    f     2534        36      419      160      565      888
# ℹ 11,328 more rows
# ℹ 37 more variables: Ano_2002 &lt;int&gt;, Ano_2003 &lt;int&gt;, Ano_2004 &lt;int&gt;,
#   Ano_2005 &lt;int&gt;, Ano_2006 &lt;int&gt;, Ano_2007 &lt;int&gt;, Ano_2008 &lt;int&gt;,
#   Ano_2009 &lt;int&gt;, Ano_2010 &lt;int&gt;, Ano_2011 &lt;int&gt;, Ano_2012 &lt;int&gt;,
#   Ano_2013 &lt;int&gt;, Ano_2014 &lt;int&gt;, Ano_2015 &lt;int&gt;, Ano_2016 &lt;int&gt;,
#   Ano_2017 &lt;int&gt;, Ano_2018 &lt;int&gt;, Ano_2019 &lt;int&gt;, Ano_2020 &lt;int&gt;,
#   Ano_2021 &lt;int&gt;, Ano_1995 &lt;int&gt;, Ano_1996 &lt;int&gt;, Ano_1980 &lt;int&gt;, …</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Utilizando os dados de TB5, crie uma tabela em formato wide, com a quantidade de casos por país, ano, idade e sexo.</li>
</ol>
<ul>
<li>Dica: Utilize o argumento <code>values_fn</code> da função.</li>
</ul>
<ol start="3" type="1">
<li>Volte o banco criado em 1 e 2 para o formato <code>long</code>.</li>
</ol></section></section><section id="strings" class="level2"><h2 class="anchored" data-anchor-id="strings">4.9 Strings</h2>
<p>No <a href="https://gysi.quarto.pub/ce302/chapters/02_basicR.html">Capítulo 2</a> vimos como criar a fazer manipulações simples em <em>strings</em>. Agora vamos aprofundar nossos conhecimentos em manipulação de <em>strings</em>. Para trabalharmos com strings em R, podemos utilizar diversos pacotes, como o <code>base</code>, <code>stringr</code> e <code>stringi</code> . Nas aulas introdutórias focamos apenas nas funções do <code>base</code>, agora vamos focar nas funções do stringr. As funções do pacote <code>stringr</code> são, na sua maioria, wrappers das funções implementadas no <code>stringi</code> .</p>
<p>Strings são objetos (ou variáveis) do tipo texto, e são delimitadas por aspas (duplas ou simples).</p>
<div class="cell">
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats 1.0.0     ✔ readr   2.1.4
✔ ggplot2 3.4.3     ✔ stringr 1.5.0
✔ purrr   1.0.1     ✔ tibble  3.2.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ data.table::between() masks dplyr::between()
✖ tidyr::extract()      masks magrittr::extract()
✖ dplyr::filter()       masks stats::filter()
✖ data.table::first()   masks dplyr::first()
✖ lubridate::hour()     masks data.table::hour()
✖ lubridate::isoweek()  masks data.table::isoweek()
✖ dplyr::lag()          masks stats::lag()
✖ data.table::last()    masks dplyr::last()
✖ lubridate::mday()     masks data.table::mday()
✖ lubridate::minute()   masks data.table::minute()
✖ lubridate::month()    masks data.table::month()
✖ lubridate::quarter()  masks data.table::quarter()
✖ lubridate::second()   masks data.table::second()
✖ purrr::set_names()    masks magrittr::set_names()
✖ purrr::transpose()    masks data.table::transpose()
✖ lubridate::wday()     masks data.table::wday()
✖ lubridate::week()     masks data.table::week()
✖ lubridate::yday()     masks data.table::yday()
✖ lubridate::year()     masks data.table::year()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Seu nome aqui"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">'Seu nome aqui'</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">==</span> <span class="va">y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Caso eu tenha interesse em criar uma string que contenha aspas, podemos cria-la da seguinte maneira:</p>
<div class="cell">
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var_com_aspas</span> <span class="op">&lt;-</span> <span class="st">"Ela disse: 'Eu adoro lasanha.'"</span></span>
<span><span class="va">var_com_aspas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ela disse: 'Eu adoro lasanha.'"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">var_com_aspas</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Ela disse: 'Eu adoro lasanha.'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var_com_aspas2</span> <span class="op">&lt;-</span> <span class="st">'Ela disse: "Eu adoro lasanha."'</span></span>
<span><span class="va">var_com_aspas2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ela disse: \"Eu adoro lasanha.\""</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">var_com_aspas2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Ela disse: "Eu adoro lasanha."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var_com_aspas3</span> <span class="op">&lt;-</span> <span class="st">"Ela disse: \"Eu adoro lasanha.\""</span></span>
<span><span class="va">var_com_aspas3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ela disse: \"Eu adoro lasanha.\""</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">var_com_aspas3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Ela disse: "Eu adoro lasanha."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var_com_aspas4</span> <span class="op">&lt;-</span> <span class="st">'Ela disse: \'Eu adoro lasanha.\''</span></span>
<span><span class="va">var_com_aspas4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ela disse: 'Eu adoro lasanha.'"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">var_com_aspas4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Ela disse: 'Eu adoro lasanha.'</code></pre>
</div>
</div>
<section id="caracteres-especiais" class="level3"><h3 class="anchored" data-anchor-id="caracteres-especiais">4.9.1 Caracteres especiais</h3>
<p>Quando estamos trabalhando com textos, frequentemente temos caracteres especiais. Caracteres especiais são caracteres que não são alfanuméricos e muitas vezes têm funções específicas ou significados especiais em linguagens de programação e processamento de texto. Aqui estão alguns exemplos comuns de caracteres especiais:</p>
<ul>
<li>
<strong>Espaço em Branco</strong>: O espaço em branco, muitas vezes representado como ” ” ou “” em linguagens de programação, é um caractere especial que denota um espaço vazio entre palavras ou caracteres em uma string.
<ul>
<li>Em R, podemos usar espaços em branco em strings de texto da maneira usual. Por exemplo:</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="st">"Isso é um exemplo de texto com espaços em branco."</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Isso é um exemplo de texto com espaços em branco.</code></pre>
</div>
</div>
<ul>
<li>
<strong>Nova Linha ()</strong>: O caractere “” é usado para representar uma quebra de linha em uma string. Quando incluído em uma string, ele faz com que o texto subsequente seja exibido em uma nova linha.
<ul>
<li>Para criar uma nova linha em uma string, podemos usar “”. Isso é útil para criar múltiplas linhas de texto.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_multilinhas</span> <span class="op">&lt;-</span> <span class="st">"Primeira linha\nSegunda linha\nTerceira linha"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto_multilinhas</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Primeira linha
    │ Segunda linha
    │ Terceira linha</code></pre>
</div>
</div>
<ul>
<li>
<strong>Tabulação (</strong>: O caractere “ representa uma tabulação horizontal. É frequentemente usado para criar recuos ou alinhar o texto em colunas.
<ul>
<li>Para adicionar tabulações em uma string, você pode usar “.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_tabulado</span> <span class="op">&lt;-</span> <span class="st">"Primeira coluna\tSegunda coluna\tTerceira coluna"</span> </span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto_tabulado</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Primeira coluna{\t}Segunda coluna{\t}Terceira coluna</code></pre>
</div>
</div>
<ul>
<li>
<strong>Caracteres de Escape ()</strong>: O caractere “” é usado como um caractere de escape em muitas linguagens de programação. Isso significa que ele “escapa” o significado especial de outros caracteres, permitindo que você os inclua em uma string. Por exemplo, “” é usado para representar uma única barra invertida em vez de um caractere de escape.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_com_barras</span> <span class="op">&lt;-</span> <span class="st">"Isso é uma única barra invertida: \\"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto_com_barras</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Isso é uma única barra invertida: \</code></pre>
</div>
</div>
<ul>
<li>
<strong>Caracteres Unicode</strong>: Em linguagens de programação modernas, podemos usar caracteres Unicode em strings para representar uma ampla variedade de caracteres especiais de diferentes idiomas e símbolos.
<ul>
<li>Podemos utilizar códigos Unicode para incluir caracteres especiais em uma string em R. Por exemplo, o símbolo do grau (°) pode ser representado pelo código Unicode “0B0”.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_unicode_grau</span> <span class="op">&lt;-</span> <span class="st">"A temperatura é de 25\u00B0C."</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto_unicode_grau</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ A temperatura é de 25°C.</code></pre>
</div>
</div>
<ul>
<li>O símbolo “” (nova linha), pode ser representados usando seus códigos Unicode.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_multilinhas_unicode</span> <span class="op">&lt;-</span> <span class="st">"Primeira linha\u000ASegunda linha"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">texto_multilinhas_unicode</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ Primeira linha
    │ Segunda linha</code></pre>
</div>
</div>
<ul>
<li>Caracteres matemáticos, como o símbolo de somatório (<span class="math inline">\(\sum\)</span>), podem ser representados com seus códigos Unicode.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simbolo_somatorio</span> <span class="op">&lt;-</span> <span class="st">"O símolo do somatório é: \u2211"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">simbolo_somatorio</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ O símolo do somatório é: ∑</code></pre>
</div>
</div>
<ul>
<li>Emojis também podem ser representados por Unicode.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">emoji</span> <span class="op">&lt;-</span> <span class="st">"OMG! Também posso usar emoji! \U1F631"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">emoji</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ OMG! Também posso usar emoji! 😱</code></pre>
</div>
</div>
</section><section id="concatenando-strings" class="level3"><h3 class="anchored" data-anchor-id="concatenando-strings">4.9.2 Concatenando strings</h3>
<p>Muitas vezes temos interesse em combinar strings, como faziamos antes com a função <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>nome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ana"</span>, <span class="st">"Maria"</span>, <span class="st">"João"</span>, <span class="cn">NA</span><span class="op">)</span>, </span>
<span>                 sobrenome<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Santos"</span>, <span class="st">"Silva"</span>, <span class="st">"Souza"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ola <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"Boa noite "</span>, <span class="va">nome</span>, <span class="st">" "</span>, <span class="va">sobrenome</span>, <span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome                    ola
1   Ana    Santos  Boa noite Ana Santos!
2 Maria     Silva Boa noite Maria Silva!
3  João     Souza  Boa noite João Souza!
4  &lt;NA&gt;      &lt;NA&gt;                   &lt;NA&gt;</code></pre>
</div>
</div>
<p>Alternativamente, quando temos diversas variáveis que queremos combinar, podemos utilizar a função <code>str_glue</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mensagem <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Boa noite {nome} {sobrenome}!"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome               mensagem
1   Ana    Santos  Boa noite Ana Santos!
2 Maria     Silva Boa noite Maria Silva!
3  João     Souza  Boa noite João Souza!
4  &lt;NA&gt;      &lt;NA&gt;       Boa noite NA NA!</code></pre>
</div>
</div>
<p>Outra opção para a qual utilizamavamos o <code>paste</code>, era para unir todos os elementos de uma string, utilizando o argumento <code>collapse</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">nome</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">.</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ana, Maria, João, NA"</code></pre>
</div>
</div>
<p>Uma alternativa é utilizarmos a função <code>str_flatten</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">nome</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AnaMariaJoão"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">nome</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span>, collapse <span class="op">=</span> <span class="st">", "</span>, last <span class="op">=</span> <span class="st">" e "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ana, Maria e João"</code></pre>
</div>
</div>
</section><section id="separando-strings" class="level3"><h3 class="anchored" data-anchor-id="separando-strings">4.9.3 Separando Strings</h3>
<p>Muitas vezes precisamos separar uma string em duas (ou mais). Na aula passada vimos a função <code>separate</code>. Hoje vamos ver a <code>str_split</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Nome_Sobrenome <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">nome</span>, <span class="va">sobrenome</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">Nome_Sobrenome</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">" "</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]    [,2]    
[1,] "Ana"   "Santos"
[2,] "Maria" "Silva" 
[3,] "João"  "Souza" 
[4,] NA      ""      </code></pre>
</div>
</div>
</section><section id="formatação-básica" class="level3"><h3 class="anchored" data-anchor-id="formatação-básica">4.9.4 Formatação básica</h3>
<p>Muitas vezes queremos passar um texto para caixa alta, caixa baixa, título ou até mesmo formato de sentença. Para isso podemos utilizar as funções: <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code> e <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence()</a></code> respectivamente.</p>
<div class="cell">
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_exemplo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"caixa baixa"</span>, <span class="st">"CAIXA ALTA"</span>, <span class="st">"Texto de sentença"</span>, <span class="st">"Texto Em Título"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">texto_exemplo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "caixa baixa"       "caixa alta"        "texto de sentença"
[4] "texto em título"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence</a></span><span class="op">(</span><span class="va">texto_exemplo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Caixa baixa"       "Caixa alta"        "Texto de sentença"
[4] "Texto em título"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">texto_exemplo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Caixa Baixa"       "Caixa Alta"        "Texto De Sentença"
[4] "Texto Em Título"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper</a></span><span class="op">(</span><span class="va">texto_exemplo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CAIXA BAIXA"       "CAIXA ALTA"        "TEXTO DE SENTENÇA"
[4] "TEXTO EM TÍTULO"  </code></pre>
</div>
</div>
<p>Algumas vezes recebemos um texto desformatado, no sentido de conter diversos espaços no meio do texto. E temos interesse em limpar os excessos de espaço. Para isso podemos utilizar as seguintes funções: <code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim()</a></code> e <code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto_com_espaços</span> <span class="op">=</span> <span class="st">"  Olá, esse texto tem    diversos        espaços completamente desnecessários. "</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">texto_com_espaços</span>, side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Olá, esse texto tem    diversos        espaços completamente desnecessários. "</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">texto_com_espaços</span>, side <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "  Olá, esse texto tem    diversos        espaços completamente desnecessários."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">texto_com_espaços</span>, side <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Olá, esse texto tem    diversos        espaços completamente desnecessários."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish</a></span><span class="op">(</span><span class="va">texto_com_espaços</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Olá, esse texto tem diversos espaços completamente desnecessários."</code></pre>
</div>
</div>
</section><section id="comprimento-de-string" class="level3"><h3 class="anchored" data-anchor-id="comprimento-de-string">4.9.5 Comprimento de string</h3>
<p>Muitas vezes temos interesse em encontrar textos incorretos em um banco de dados, uma maneira de identificar essas observações é simplesmente por contar a quantidade de caracteres de uma string. Para isso podemos utilizar a função <code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>comprimento_nome <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">nome</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome Nome_Sobrenome comprimento_nome
1   Ana    Santos     Ana Santos                3
2 Maria     Silva    Maria Silva                5
3  João     Souza     João Souza                4
4  &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;               NA</code></pre>
</div>
</div>
<p>Alternativamente podemos estar interessados em contar a quantidade de caracteres especificos. Para isso, utilizamos a função <code><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>qtd_a <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome Nome_Sobrenome qtd_a
1   Ana    Santos     Ana Santos     1
2 Maria     Silva    Maria Silva     2
3  João     Souza     João Souza     0
4  &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;    NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>qtd_vogais <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"[aeiou]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>qtd_consoantes <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"[^aeiou]"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome Nome_Sobrenome qtd_vogais qtd_consoantes
1   Ana    Santos     Ana Santos          1              2
2 Maria     Silva    Maria Silva          3              2
3  João     Souza     João Souza          2              2
4  &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;         NA             NA</code></pre>
</div>
</div>
</section><section id="substituição-de-strings" class="level3"><h3 class="anchored" data-anchor-id="substituição-de-strings">4.9.6 Substituição de strings</h3>
<p>Algumas vezes podemos estar interessados em substituir alguma string por outra. Para isso podemos utilizar a função <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nome <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"ã"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nome sobrenome Nome_Sobrenome
1   Ana    Santos     Ana Santos
2 Maria     Silva    Maria Silva
3  Joao     Souza     João Souza
4  &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;</code></pre>
</div>
</div>
<p>Outras vezes queremos simplesmente remover algum caracter. Para isso utilizamos a função <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> para remover a primeira instância do caracter ou <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a></code> para remover todas as instâncias.</p>
<div class="cell">
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nome <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"[aeiouã]"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nome sobrenome Nome_Sobrenome
1   An    Santos     Ana Santos
2 Mria     Silva    Maria Silva
3  Jão     Souza     João Souza
4 &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nome <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">nome</span>, <span class="st">"[aeiouã]"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nome sobrenome Nome_Sobrenome
1   An    Santos     Ana Santos
2   Mr     Silva    Maria Silva
3    J     Souza     João Souza
4 &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;</code></pre>
</div>
</div>
</section><section id="expressões-regulares" class="level3"><h3 class="anchored" data-anchor-id="expressões-regulares">4.9.7 Expressões Regulares</h3>
<p>Expressões regulares, muitas vezes abreviadas como “RegEx” são padrões de texto que descrevem conjuntos de <em>strings</em>. Elas são amplamente utilizadas para realizar operações de busca, correspondência e manipulação de <em>strings</em> em linguagens de programação e ferramentas de processamento de texto, incluindo R. Alguns símbolos e conceitos-chave em expressões regulares:</p>
<ol type="1">
<li>
<strong>Literais:</strong> Caracteres literais correspondem a si mesmos. Por exemplo, a regex “abc” corresponderá à sequência “abc” em uma string.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="st">"O gato é um animal adorável."</span></span>
<span><span class="va">padrao</span> <span class="op">&lt;-</span> <span class="st">"gato"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="va">padrao</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>
<strong>Meta-caracteres:</strong> São caracteres com significados especiais em regex. Alguns exemplos incluem:</li>
</ol>
<ul>
<li>
<code>.</code> (ponto): Corresponde a qualquer caractere, exceto uma nova linha.</li>
<li>
<code>*</code>: Corresponde a zero ou mais ocorrências do caractere ou grupo anterior.</li>
<li>
<code>+</code>: Corresponde a uma ou mais ocorrências do caractere ou grupo anterior.</li>
<li>
<code>?</code>: Corresponde a zero ou uma ocorrência do caractere ou grupo anterior.</li>
<li>
<code>[]</code>: Define uma classe de caracteres. Por exemplo, <code>[aeiou]</code> corresponde a qualquer vogal.</li>
<li>
<code>|</code> (barra vertical): Funciona como um “OU” lógico. Por exemplo, “a|b” corresponde a “a” ou “b”.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"O rato correu para o buraco."</span>, </span>
<span>           <span class="st">"O gato correu para o buraco."</span>,</span>
<span>           <span class="st">"O mato."</span><span class="op">)</span></span>
<span><span class="va">padrao</span> <span class="op">&lt;-</span> <span class="st">"(g|r)ato"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="va">padrao</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>
<strong>Âncoras</strong>: São usadas para ancorar padrões em posições específicas da string.</li>
</ol>
<ul>
<li>
<code>^</code>: Corresponde ao início da string.</li>
<li>
<code>$</code>: Corresponde ao final da string.</li>
<li>
<code>\b</code>: Corresponde a uma borda de palavra (início ou fim de uma palavra).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Banana"</span>, <span class="st">"Ana"</span>, <span class="st">"Ananas"</span><span class="op">)</span></span>
<span><span class="va">padrao</span> <span class="op">&lt;-</span> <span class="st">"^ana"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="va">padrao</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ignorar case</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="st">"(?i)ana"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ignorar case, terminar com ana</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="st">"(?i)ana$"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ignorar case, começar com ana</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="st">"(?i)^ana"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ignorar case, exatamente  ana</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texto</span>, <span class="st">"(?i)^ana$"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>
<strong>Grupos</strong>: Parênteses <code>()</code> são usados para agrupar caracteres em subexpressões. Isso é útil para aplicar operadores a um conjunto de caracteres.</li>
</ol>
<ul>
<li>Exemplo: <code>(abc)+</code> corresponde a “abc”, “abcabc”, “abcabcabc”, etc.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">texto</span>, <span class="st">"(na)+"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "nana" "na"   "nana"</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>
<strong>Quantificadores</strong>: Controlam o número de ocorrências de um caractere ou grupo.</li>
</ol>
<ul>
<li>
<code>{n}</code>: Corresponde exatamente a n ocorrências.</li>
<li>
<code>{n,}</code>: Corresponde a pelo menos n ocorrências.</li>
<li>
<code>{n,m}</code>: Corresponde de n a m ocorrências.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="st">"Os números 123 e 456 são importantes."</span></span>
<span><span class="va">padrao</span> <span class="op">&lt;-</span> <span class="st">"\\d{3}"</span></span>
<span><span class="va">numeros</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">texto</span>, <span class="va">padrao</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">numeros</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2] 
[1,] "123" "456"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">texto</span> <span class="op">&lt;-</span> <span class="st">"Os números 123, 456 e 78 são importantes."</span></span>
<span><span class="va">padrao</span> <span class="op">&lt;-</span> <span class="st">"\\d{2}"</span></span>
<span><span class="va">numeros</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">texto</span>, <span class="va">padrao</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">numeros</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] "12" "45" "78"</code></pre>
</div>
</div>
</section><section id="exercício-2" class="level3"><h3 class="anchored" data-anchor-id="exercício-2">4.9.8 Exercício</h3>
<p>Utilizando os dados disponíveis em <code>words</code> crie RegEx capaz de encontrar palavras que:</p>
<ol type="1">
<li><p>Comece com “y”.</p></li>
<li><p>Não comece com “y”.</p></li>
<li><p>Termine com “x”.</p></li>
<li><p>Tenham exatamente três letras.</p></li>
<li><p>Tenham sete letras ou mais.</p></li>
<li><p>Contenham um par vogal-consoante.</p></li>
<li><p>Contenham pelo menos dois pares vogal-consoante consecutivos.</p></li>
</ol>
<p>Para cada um dos desafios a seguir, tente resolvê-los usando tanto uma única expressão regular quanto uma combinação de várias chamadas de <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code>:</p>
<ol type="1">
<li><p>Encontre todas as palavras que começam ou terminam com “x”.</p></li>
<li><p>Encontre todas as palavras que começam com uma vogal e terminam com uma consoante.</p></li>
<li><p>Existem palavras que contêm pelo menos uma de cada vogal diferente?</p></li>
<li><p>Em <code><a href="https://rdrr.io/r/grDevices/colors.html">colors()</a></code> existem diversos modificadores de cores como <em>light</em> e <em>dark</em>. Crie um banco contendo o nome da cor original e o nome sem o modificador.</p></li>
</ol></section></section><section id="cheatsheets" class="level2"><h2 class="anchored" data-anchor-id="cheatsheets">4.10 Cheatsheets</h2>
<ul>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf">TidyR</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/translations/portuguese/data-wrangling_pt.pdf">Manipulando dados</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/lubridate.pdf">Lubridate</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">Strings</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/regex.pdf">RegEx</a></p></li>
<li><p><a href="https://regexr.com/">Para saber mais sobre RegEx</a></p></li>
<li><p>Jogo de palavra cruzadas em <a href="https://regexcrossword.com/">RegEx</a>.</p></li>
</ul>


</section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>